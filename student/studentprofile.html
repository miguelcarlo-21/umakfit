<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profile - UMakFit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Manrope:wght@600;800&display=swap" rel="stylesheet">
    <style>
    * {
        font-family: 'Inter', sans-serif;
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
    }
    
    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
        margin: 0;
        padding: 0;
    }
    
        /* Navigation */
        .navbar-custom {
            background: linear-gradient(180deg, rgba(30, 58, 138, 1) 0%, rgba(59, 130, 246, 1) 100%);
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-bottom: none;
            height: auto;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 0;
            padding: 0;
        }

        .navbar-brand-img {
            height: 60px;
            width: auto;
            object-fit: contain;
        }

        .navbar-brand-text {
            font-family: "Manrope", Helvetica;
            font-weight: 800;
            font-size: 28px;
            background: linear-gradient(90deg, rgba(245, 158, 11, 1) 0%, rgba(255, 229, 0, 1) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .nav-pills-custom {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 0;
            margin: 0;
            list-style: none;
        }

        .nav-link-custom {
            font-family: "Manrope", Helvetica;
            font-weight: 600;
            color: #000000;
            font-size: 14px;
            padding: 12px 18px;
            border-radius: 8px;
            background-color: #ffffff;
            transition: all 0.3s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-decoration: none;
        }

        .nav-link-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            color: #000000;
        }

        .nav-link-custom i {
            font-size: 14px;
        }

        .nav-link-custom.active {
            background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
        }

        .notification-bell-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0;
        }

        .notification-bell-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
        }

        .notification-bell-btn i {
            font-size: 20px;
        }

        .btn-logout-nav {
            background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
            border: none;
            color: #000000;
            padding: 8px 20px;
            border-radius: 8px;
            font-family: "Manrope", Helvetica;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-logout-nav:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
        }

        .notification-bell-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            min-width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .notification-bell-container {
            position: relative;
            display: inline-block;
        }

        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            width: 380px;
            max-height: 480px;
            overflow-y: auto;
            z-index: 1050;
            display: none;
            margin-top: 0.5rem;
            animation: slideDown 0.3s ease;
        }

        .notification-dropdown.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification-dropdown-header {
            padding: 1rem 1.25rem;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            border-radius: 12px 12px 0 0;
        }

        .notification-dropdown-header h6 {
            margin: 0;
            font-size: 16px;
            font-weight: 700;
            color: #111827;
        }

        .notification-dropdown-body {
            max-height: 360px;
            overflow-y: auto;
        }

        .notification-dropdown-item {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .notification-dropdown-item:hover {
            background-color: #f9fafb;
        }

        .notification-dropdown-item:last-child {
            border-bottom: none;
        }

        .notification-dropdown-item strong {
            color: #111827;
            font-size: 14px;
            display: block;
            margin-bottom: 0.35rem;
            font-weight: 600;
        }

        .notification-dropdown-item p {
            color: #6b7280;
            font-size: 13px;
            margin: 0;
            line-height: 1.5;
        }

        .notification-dropdown-item small {
            color: #9ca3af;
            font-size: 11px;
            display: block;
            margin-top: 0.35rem;
        }

        .notification-dropdown-footer {
            padding: 0.75rem 1.25rem;
            border-top: 2px solid #e5e7eb;
            text-align: center;
            background-color: #f9fafb;
            border-radius: 0 0 12px 12px;
        }

        .btn-view-all-dropdown {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-view-all-dropdown:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        .notification-dropdown-empty {
            padding: 2rem 1.25rem;
            text-align: center;
            color: #9ca3af;
        }

        .notification-dropdown-empty i {
            font-size: 48px;
            color: #d1d5db;
            margin-bottom: 0.75rem;
            display: block;
        }

        .notification-dropdown-empty p {
            color: #6b7280;
            font-size: 14px;
            margin: 0;
        }

        .navbar-toggler {
            background-color: #ffffff;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
        }

        .navbar-toggler:focus {
            box-shadow: 0 0 0 0.25rem rgba(255,255,255,0.25);
        }

        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(0,0,0,1)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E") !important;
        }
            @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-down {
            animation: slideDown 0.3s ease;
        }

        /* Ensure dropdown z-index is high enough */
        #profileDropdown,
        #profileDropdownMobile,
        #notificationDropdown {
            z-index: 9999 !important;
        }

   
.profile-title {
    font-family: "Inter", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-weight: 600;
    color: #1f3b7c; 
    font-size: 1.45rem; 
    line-height: 1.6;
    letter-spacing: 0.3px;
    text-transform: capitalize;
    margin-top: 1.5rem;
    margin-bottom: 1.25rem;
    text-align: left;
    position: relative;
}


.profile-title::after {
    content: "";
    display: block;
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, #1f3b7c, #3b82f6);
    margin-top: 0.5rem;
    border-radius: 2px;
}


    
    .profile-sidebar {
        background-color: #ffffff;
        border-radius: 8px;
        padding: 2rem 1.5rem;
    }
    
    .profile-avatar {
        width: 98px;
        height: 92px;
        background-color: transparent;
        border-radius: 50%;
        margin: 0 auto 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .profile-avatar i {
        font-size: 82px;
        color: #666;
    }
    
    .profile-name {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 18px;
        letter-spacing: -0.18px;
        line-height: 25.2px;
        text-align: center;
        margin-bottom: 0.5rem;
    }
    
    .profile-id {
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        color: #000000;
        font-size: 13px;
        letter-spacing: -0.13px;
        line-height: 18.2px;
        text-align: center;
        margin-bottom: 1.5rem;
    }
    
    .profile-section-badge {
        background-color: #1e3a8a;
        border-radius: 18px;
        padding: 0.5rem 1rem;
        color: #ffffff;
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        font-size: 12px;
        letter-spacing: -0.12px;
        line-height: 16.8px;
        text-align: center;
        margin: 0 auto 1.5rem;
    }
    
    .profile-info-item {
        border-top: 1px solid #e0e0e0;
        padding: 1rem 0;
    }
    
    .profile-info-label {
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        color: rgba(0, 0, 0, 0.5);
        font-size: 8px;
        letter-spacing: -0.08px;
        line-height: 11.2px;
        text-transform: uppercase;
        margin-bottom: 0.25rem;
    }
    
    .profile-info-value {
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        color: #000000;
        font-size: 11px;
        letter-spacing: -0.11px;
        line-height: 15.4px;
    }
    
    .medical-condition-box {
        background-color: #ffffff;
        border: 1px solid #1e3a8a;
        border-radius: 2px;
        padding: 1rem;
        min-height: 83px;
        margin-top: 1rem;
    }
    
    .edit-profile-btn {
        background: linear-gradient(90deg, rgba(18, 27, 103, 1) 0%, rgba(59, 130, 246, 1) 100%);
        color: #ffffff;
        border: none;
        border-radius: 7px;
        padding: 0.5rem;
        width: 100%;
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        font-size: 14px;
        letter-spacing: -0.14px;
        line-height: 19.6px;
        margin-top: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .edit-profile-btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }
    
    .physiological-card,
    .test-history-card {
        background-color: #ffffff;
        border-radius: 7px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        overflow: hidden;
    }
    
    .card-title-custom {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 18px;
        letter-spacing: -0.18px;
        line-height: 25.2px;
        margin-bottom: 1.5rem;
    }
    
    .physio-box {
        background-color: #eceff8;
        border: 1px solid #9f9f9f;
        border-radius: 6px;
        padding: 1.5rem;
        text-align: center;
    }
    
    .physio-icon {
        width: 45px;
        height: 45px;
        margin-bottom: 0.5rem;
        object-fit: cover;
    }
    
    .physio-label {
        font-family: 'Inter', Helvetica;
        font-weight: 400;
        color: #000000;
        font-size: 13px;
        letter-spacing: -0.13px;
        line-height: 18.2px;
        margin-bottom: 0.5rem;
    }
    
    .physio-value {
        font-family: 'Inter', Helvetica;
        font-weight: 700;
        color: #000000;
        font-size: 24px;
        letter-spacing: -0.24px;
        line-height: 33.6px;
    }
    
    .physio-unit {
        font-size: 13px;
        font-weight: 400;
        letter-spacing: -0.13px;
        line-height: 18.2px;
    }
    
    .test-history-table {
        width: 100%;
    }
    
    .test-history-header {
        background-color: #eceff8;
        border: 1px solid #9f9f9f;
    }
    
    .test-history-header th {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 18px;
        letter-spacing: -0.18px;
        line-height: 25.2px;
        padding: 1rem;
    }
    
    .test-history-row {
        border-bottom: 2px solid #e0e0e0;
    }
    
    .test-history-cell {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #000000;
        font-size: 18px;
        letter-spacing: -0.18px;
        line-height: 25.2px;
        padding: 1rem;
    }
    
    .test-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 14px;
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        font-size: 11px;
        letter-spacing: 0;
        line-height: 17.4px;
        display: inline-block;
    }
    
    .badge-excellent {
        background-color: #a4fbb1;
        color: #000000;
    }
    
    .badge-good {
        background-color: #3b82f6;
        color: #000000;
    }
    
    .badge-needs-improvement {
        background-color: #fbbf24;
        color: #000000;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 1.5rem;
        color: #64748b;
    }
    
    .empty-state i {
        font-size: 56px;
        color: #cbd5e1;
        margin-bottom: 1rem;
    }
    
    .footer-custom {
        background-color: #1e3a8a;
        color: white;
        padding: 3rem 0 1rem;
        margin-top: 4rem;
    }
    
    .footer-heading {
        color: #f59e0b;
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        font-size: 16px;
        letter-spacing: 0;
        line-height: 25.3px;
        margin-bottom: 1rem;
    }
    
    .footer-text {
        font-family: 'Inter', Helvetica;
        font-weight: 600;
        color: #9f9f9f;
        font-size: 14px;
        letter-spacing: 0;
        line-height: 22.1px;
    }
    
    .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.98);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        flex-direction: column;
        gap: 20px;
    }
    
    .spinner {
        border: 4px solid #e5e7eb;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
   @media (max-width: 991px) {
    .nav-link-custom {
        width: 100%;
        justify-content: flex-start;
    }
    
    .btn-logout-nav {
        width: 100%;
        justify-content: center;
    }
    
    .notification-bell-container {
        width: 100%;
        display: flex;
        justify-content: center;
    }
}
</style>
</head>
<body>
    <div id="loadingScreen" class="loading">
        <div class="spinner"></div>
        <div class="loading-text">Loading Profile...</div>
    </div>

    <div id="mainContent" style="display: none;">
        <!-- Navigation -->
<nav class="bg-gradient-to-r from-blue-900 to-blue-500 shadow-lg">
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-5">
        <div class="flex flex-wrap items-center justify-between gap-3 sm:gap-4">
            <!-- Logo -->
            <a href="#" class="flex items-center gap-2 sm:gap-3">
                <img src="https://c.animaapp.com/vkhEa8zW/img/screenshot-2025-09-19-2-53-51-pm-removebg-preview-3@2x.png" 
                     alt="UMak Logo" class="h-12 sm:h-14 md:h-16 w-auto object-contain">
                <span class="text-xl sm:text-2xl md:text-3xl font-extrabold font-manrope bg-gradient-to-r from-yellow-400 to-yellow-200 bg-clip-text text-transparent">
                    UMakFit
                </span>
            </a>
            
            <!-- Desktop Navigation -->
<div class="hidden lg:flex items-center gap-2 flex-wrap">
    <a href="./studentDashboard.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
        <i class="bi bi-speedometer2"></i> 
        <span class="hidden xl:inline">Dashboard</span>
    </a>
    <a href="./test.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
        <i class="bi bi-clipboard-check"></i> 
        <span class="hidden xl:inline">Test</span>
    </a>
    <a href="./studentlesson.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
        <i class="bi bi-book"></i> 
        <span class="hidden xl:inline">Lesson</span>
    </a>
    <a href="./studentgrades.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
        <i class="bi bi-award"></i> 
        <span class="hidden xl:inline">Grades</span>
    </a>
    <a href="./progress.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
        <i class="bi bi-graph-up"></i> 
        <span class="hidden xl:inline">Progress</span>
    </a>
    <a href="#" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
        <i class="bi bi-trophy"></i> 
        <span class="hidden xl:inline">Achievements</span>
    </a>
    
    <!-- Notification Bell -->
    <div class="relative">
        <button id="notificationBellBtn" 
                class="w-9 h-9 xl:w-10 xl:h-10 bg-white/20 border-2 border-white/30 rounded-full flex items-center justify-center text-white hover:bg-white/30 hover:scale-110 transition-all">
            <i class="bi bi-bell-fill text-base xl:text-lg"></i>
            <span id="navNotificationCount" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full min-w-[18px] h-4.5 flex items-center justify-center">0</span>
        </button>
        
        <!-- Notification Dropdown -->
        <div id="notificationDropdown" class="hidden absolute right-0 mt-2 w-96 max-w-[calc(100vw-2rem)] bg-white rounded-xl shadow-2xl z-[9999] max-h-[480px] overflow-y-auto">
            <div class="p-4 border-b-2 border-gray-200 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center rounded-t-xl sticky top-0 z-10">
                <h6 class="font-bold text-gray-900 text-base flex items-center gap-2">
                    <i class="bi bi-bell-fill text-blue-500"></i> Notifications
                </h6>
                <button onclick="closeNotificationDropdown()" class="text-gray-400 hover:text-gray-600 p-1">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div id="notificationDropdownBody" class="max-h-96 overflow-y-auto">
                <div class="p-8 text-center text-gray-400">
                    <i class="bi bi-bell-slash text-5xl mb-3 block"></i>
                    <p class="text-gray-600">No notifications yet</p>
                </div>
            </div>
        </div>
    </div>
                
               <!-- Profile Dropdown -->
            <div class="relative">
                <img src="" alt="Profile" id="profilePictureBtn" onclick="toggleProfileDropdown()"
                    class="w-9 h-9 xl:w-10 xl:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 hover:scale-105 transition-all object-cover">
                
                <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999] slide-down">
                    <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                        <img src="" alt="Profile" id="profileDropdownPicture" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                        <h6 id="profileDropdownName" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                        <p id="profileDropdownEmail" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
                    </div>
                    <div class="p-2">
                        <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                            <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                        </a>
                        <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                        <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                            <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                            <span class="font-medium text-sm sm:text-base">Logout</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Right Icons -->
            <div class="flex lg:hidden items-center gap-2 sm:gap-3">
                <!-- Mobile Profile -->
            <div class="relative">
                <img src="" alt="Profile" id="profilePictureBtnMobile" onclick="toggleProfileDropdown()"
                    class="w-9 h-9 sm:w-10 sm:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 object-cover">
                
                <!-- Mobile Profile Dropdown -->
                <div id="profileDropdownMobile" class="hidden fixed right-2 top-20 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999] slide-down">
                    <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                        <img src="" alt="Profile" id="profileDropdownPictureMobile" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                        <h6 id="profileDropdownNameMobile" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h4>
                        <p id="profileDropdownEmailMobile" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
                    </div>
                    <div class="p-2">
                        <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                            <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                        </a>
                        <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                        <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                            <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                            <span class="font-medium text-sm sm:text-base">Logout</span>
                        </div>
                    </div>
                </div>
            </div>
                
                <!-- Mobile Menu Button -->
                <button onclick="toggleMobileMenu()" class="text-white p-1 sm:p-2">
                    <i class="bi bi-list text-2xl sm:text-3xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Navigation Menu -->
        <div id="mobileMenu" class="hidden lg:hidden mt-3 sm:mt-4 space-y-2">
            <a href="./studentDashboard.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-speedometer2 mr-2"></i> Dashboard
            </a>
            <a href="./test.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-clipboard-check mr-2"></i> Tests
            </a>
            <a href="./progress.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-graph-up mr-2"></i> Progress
            </a>
            <a href="./studentlesson.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-book mr-2"></i> Lesson
            </a>
            <a href="./studentgrades.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-award mr-2"></i> Grade
            </a>
            <a href="#" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-trophy mr-2"></i> Achievements
            </a>
        </div>
    </div>
</nav>

        <!-- Profile Content -->
        <div class="container" style="max-width: 1400px;">
            <h2 class="profile-title">Student Profile</h2>
            
            <div class="row">
                <!-- Left Sidebar -->
                <div class="col-lg-3">
                    <div class="profile-sidebar">
                        <div class="profile-avatar">
                            <i class="bi bi-person-circle"></i>
                        </div>
                        <div class="profile-name" id="profileName">Student Name</div>
                        <div class="profile-id" id="profileId">ID: 000000</div>
                        <div class="profile-section-badge" id="profileSection">Section</div>
                        
                        <div class="profile-info-item">
                            <div class="profile-info-label">Age & Gender</div>
                            <div class="profile-info-value" id="profileAgeGender">-- years - --</div>
                        </div>
                        
                        <div class="profile-info-item">
                            <div class="profile-info-label">Email Address</div>
                            <div class="profile-info-value" id="profileEmail">email@umak.edu.ph</div>
                        </div>
                        
                        <div class="profile-info-item">
                            <div class="profile-info-label">Contact Number</div>
                            <div class="profile-info-value" id="profileContact">+63 000000000</div>
                        </div>
                        
                        <div class="profile-info-item" style="border-bottom: 1px solid #e0e0e0;">
                            <div class="profile-info-label">Medical Condition</div>
                        </div>
                        
                        <div class="medical-condition-box">
                            <div class="profile-info-value" id="profileMedical">None</div>
                        </div>
                        
                        <button class="edit-profile-btn" onclick="editProfile()">Edit Profile</button>
                        <!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white;">
                <h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>Edit Profile</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Age</label>
                            <input type="number" class="form-control" id="editAge" min="15" max="100" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Gender</label>
                            <select class="form-select" id="editGender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Email Address</label>
                            <input type="email" class="form-control" id="editEmail" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Contact Number</label>
                            <input type="tel" class="form-control" id="editContact" placeholder="+63 9XXXXXXXXX" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Height (cm)</label>
                            <input type="number" class="form-control" id="editHeight" min="100" max="250" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Weight (kg)</label>
                            <input type="number" class="form-control" id="editWeight" min="30" max="200" required>
                        </div>
                       
                        <div class="col-12">
                            <label class="form-label fw-bold">Medical Condition</label>
                            <textarea class="form-control" id="editMedical" rows="3" placeholder="Enter any medical conditions or allergies"></textarea>
                        </div>
                        <div class="col-12">
                            <h6 class="fw-bold mt-3 mb-3" style="color: #1e3a8a;"><i class="bi bi-phone me-2"></i>Emergency Contact</h6>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Contact Name</label>
                            <input type="text" class="form-control" id="editEmergencyName" placeholder="Full Name">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Contact Number</label>
                            <input type="tel" class="form-control" id="editEmergencyContact" placeholder="+63 9XXXXXXXXX">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Relationship</label>
                            <input type="text" class="form-control" id="editEmergencyRelation" placeholder="e.g., Mother, Father">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveProfile()" style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); border: none;">
                    <i class="bi bi-save me-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>
</div>
                    </div>
                </div>

                <!-- Right Content -->
                <div class="col-lg-9">
                    <!-- Physiological Data -->
                    <div class="physiological-card">
                        <h5 class="card-title-custom">Physiological Data</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="physio-box">
                                    <img src="https://c.animaapp.com/vkhEa8zW/img/image-126@2x.png" alt="Height" class="physio-icon">
                                    <div class="physio-label">HEIGHT</div>
                                    <div class="physio-value">
                                        <span id="profileHeight">0</span>
                                        <span class="physio-unit">CM</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="physio-box">
                                    <img src="https://c.animaapp.com/vkhEa8zW/img/image-127@2x.png" alt="Weight" class="physio-icon">
                                    <div class="physio-label">WEIGHT</div>
                                    <div class="physio-value">
                                        <span id="profileWeight">0</span>
                                        <span class="physio-unit">KG</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="physio-box">
                                    <img src="https://c.animaapp.com/vkhEa8zW/img/image-127@2x.png" alt="BMI" class="physio-icon">
                                    <div class="physio-label">BMI</div>
                                    <div class="physio-value" id="profileBMI">0.00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Activity -->
<div class="test-history-card">
    <h5 class="card-title-custom">Account Activity</h5>
    <div class="row g-3">
        <div class="col-md-6">
            <div class="physio-box">
                <i class="bi bi-clock-history" style="font-size: 45px; color: #3b82f6;"></i>
                <div class="physio-label">LAST LOGIN</div>
                <div class="physio-value" style="font-size: 16px;" id="lastLogin">Never</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="physio-box">
                <i class="bi bi-calendar-check" style="font-size: 45px; color: #10b981;"></i>
                <div class="physio-label">ACCOUNT CREATED</div>
                <div class="physio-value" style="font-size: 16px;" id="accountCreated">N/A</div>
            </div>
        </div>
    </div>
</div>



<!-- Emergency Contact -->
<div class="test-history-card">
    <h5 class="card-title-custom">Emergency Contact</h5>
    <div class="row">
        <div class="col-md-6">
            <div class="profile-info-item">
                <div class="profile-info-label">CONTACT NAME</div>
                <div class="profile-info-value" style="font-size: 16px;" id="emergencyName">Not provided</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="profile-info-item">
                <div class="profile-info-label">CONTACT NUMBER</div>
                <div class="profile-info-value" style="font-size: 16px;" id="emergencyContact">Not provided</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="profile-info-item">
                <div class="profile-info-label">RELATIONSHIP</div>
                <div class="profile-info-value" style="font-size: 16px;" id="emergencyRelation">Not provided</div>
            </div>
        </div>
    </div>
</div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer-custom">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <h6 class="footer-heading">üèÉ UMakFit</h6>
                        <p class="footer-text">
                            Empowering the University of Makati community to achieve their fitness goals through comprehensive health assessments and personalized tracking.
                        </p>
                    </div>
                    <div class="col-md-4 mb-4">
                        <h6 class="footer-heading">Platform</h6>
                        <p class="footer-text">
                            Features<br>
                            Benefits<br>
                            Student Login<br>
                            Faculty Login
                        </p>
                    </div>
                    <div class="col-md-4 mb-4">
                        <h6 class="footer-heading">Support</h6>
                        <p class="footer-text">
                            Help Center<br>
                            User Guide<br>
                            Technical Support<br>
                            System Status
                        </p>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <p class="footer-text">¬© 2025 University of Makati. All rights reserved. | UMakFit Fitness Assessment Platform</p>
                </div>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, doc, getDoc, collection, query, where, getDocs, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
        apiKey: "AIzaSyAgaLunqEf2gs6dSpF_sz1hV5XQ5Wm52jo",
        authDomain: "umakfit-e3b1d.firebaseapp.com",
        projectId: "umakfit-e3b1d",
        storageBucket: "umakfit-e3b1d.appspot.com",
        messagingSenderId: "276569891504",
        appId: "1:276569891504:web:39b1732b519f4d8b785175"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.auth = auth;
    window.signOut = signOut;

    // Helper function to capitalize names
    function capitalize(str) {
        if (!str) return '';
        return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
    }

    // Function to extract UMak ID from email
    function extractUmakIdFromEmail(email) {
        if (!email) return 'Not Assigned';
        
        const emailLower = email.toLowerCase();
        
        // Remove @umak.edu.ph if present
        let emailWithoutDomain = emailLower.replace('@umak.edu.ph', '');
        
        // Split by dots to get all parts
        const parts = emailWithoutDomain.split('.');
        
        // The ID should be the last part
        if (parts.length >= 1) {
            const lastPart = parts[parts.length - 1];
            
            // Check if it looks like an ID (starts with letter then numbers)
            // Pattern: starts with a letter, followed by digits (e.g., a12345758)
            const idPattern = /^[a-z][0-9]+$/i;
            
            if (idPattern.test(lastPart)) {
                return lastPart.toUpperCase(); // Return as uppercase
            }
            
            // Also check for alphanumeric patterns that might be IDs
            const alnumPattern = /^[a-z0-9]+$/i;
            if (alnumPattern.test(lastPart) && lastPart.length >= 7) {
                return lastPart.toUpperCase();
            }
            
            // If it's the only part and contains letters/numbers, it's likely the ID
            if (parts.length === 1 && alnumPattern.test(lastPart)) {
                return lastPart.toUpperCase();
            }
        }
        
        return 'Not Assigned';
    }

    // Function to extract name from email
    function extractNameFromEmail(email) {
        if (!email) return { firstName: 'Student', lastName: '' };
        
        const emailLower = email.toLowerCase();
        const emailWithoutDomain = emailLower.replace('@umak.edu.ph', '');
        const parts = emailWithoutDomain.split('.');
        
        if (parts.length === 1) {
            // Just ID pattern (e.g., a12345758@umak.edu.ph)
            return { firstName: 'Student', lastName: '' };
        } else if (parts.length === 2) {
            // firstname.id pattern (e.g., mtapalla.a12345758)
            return { 
                firstName: capitalize(parts[0]), 
                lastName: '' 
            };
        } else if (parts.length >= 3) {
            
            const firstName = parts[0];
            const lastName = parts[parts.length - 2]; 
            
            return {
                firstName: capitalize(firstName),
                lastName: capitalize(lastName)
            };
        }
        
        return { firstName: 'Student', lastName: '' };
    }

    function calculateBMI(weight, height) {
        const heightInMeters = height / 100;
        return (weight / (heightInMeters * heightInMeters)).toFixed(2);
    }
    function getBMICategory(bmi) {
    const bmiValue = parseFloat(bmi);
    if (bmiValue < 18.5) return 'Underweight';
    if (bmiValue >= 18.5 && bmiValue < 25) return 'Normal';
    if (bmiValue >= 25 && bmiValue < 30) return 'Overweight';
    return 'Obese';
}
    async function loadStudentProfile(user) {
        try {
            console.log('Loading student profile for:', user.email);
            
            // First, try to find student by email in students collection
            const studentsQuery = query(
                collection(db, 'students'),
                where('email', '==', user.email)
            );
            const studentsSnapshot = await getDocs(studentsQuery);
            
            let studentData = null;
            let studentDocId = null;
            
            if (!studentsSnapshot.empty) {
                console.log('Found student by email query');
                studentsSnapshot.forEach((doc) => {
                    studentData = doc.data();
                    studentDocId = doc.id;
                    console.log('Student data found:', studentData);
                });
            } else {
                console.log('No student found by email, trying by UID');
                // Try to get by UID as fallback
                const studentRef = doc(db, 'students', user.uid);
                const studentDoc = await getDoc(studentRef);
                if (studentDoc.exists()) {
                    studentData = studentDoc.data();
                    studentDocId = user.uid;
                    console.log('Student data found by UID:', studentData);
                } else {
                    console.log('No student profile found at all');
                    // Create minimal student data from Firebase auth
                    // Extract UMak ID and name from email
                    const extractedId = extractUmakIdFromEmail(user.email);
                    const nameInfo = extractNameFromEmail(user.email);
                    
                    studentData = {
                        firstName: nameInfo.firstName,
                        lastName: nameInfo.lastName,
                        umakId: extractedId,
                        section: 'Not Assigned',
                        department: 'Not Assigned',
                        yearLevel: 'Not Assigned',
                        age: 0,
                        gender: 'Not Specified',
                        email: user.email,
                        contactNumber: 'Not Provided',
                        height: 0,
                        weight: 0,
                        medicalCondition: 'None',
                        emergencyContactName: 'Not provided',
                        emergencyContactNumber: 'Not provided',
                        emergencyContactRelation: 'Not provided',
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    };
                    studentDocId = user.uid;
                    console.log('Created minimal student data:', studentData);
                }
            }
            
            if (studentData) {
                window.currentStudentId = studentDocId;
                window.currentStudentData = studentData;
                
                // Update profile display
                document.getElementById('profileName').textContent = 
                    `${studentData.firstName || ''} ${studentData.lastName || ''}`.trim() || user.email.split('@')[0];
                
                // Display UMak ID - if stored in database, use it, otherwise extract from email
                let displayId = studentData.umakId;
                if (!displayId || displayId === 'Not Assigned') {
                    displayId = extractUmakIdFromEmail(user.email);
                }
                document.getElementById('profileId').textContent = `ID: ${displayId}`;
                
                // Build section info
                let sectionInfo = '';
                if (studentData.section && studentData.section !== 'Not Assigned') {
                    sectionInfo = studentData.section;
                    if (studentData.department && studentData.department !== 'Not Assigned') {
                        sectionInfo += ` ‚Ä¢ ${studentData.department}`;
                    }
                    if (studentData.yearLevel && studentData.yearLevel !== 'Not Assigned') {
                        sectionInfo += ` ‚Ä¢ Year ${studentData.yearLevel}`;
                    }
                } else {
                    sectionInfo = 'Not Assigned';
                }
                document.getElementById('profileSection').textContent = sectionInfo;
                
                document.getElementById('profileAgeGender').textContent = 
                    `${studentData.age || 0} years - ${studentData.gender || 'Not Specified'}`;
                document.getElementById('profileEmail').textContent = 
                    studentData.email || user.email;
                document.getElementById('profileContact').textContent = 
                    studentData.contactNumber || 'Not Provided';
                document.getElementById('profileMedical').textContent = 
                    studentData.medicalCondition || 'None';
                document.getElementById('profileHeight').textContent = 
                    studentData.height || 0;
                document.getElementById('profileWeight').textContent = 
                    studentData.weight || 0;
                
                // Calculate and display BMI
                if (studentData.height && studentData.weight && studentData.height > 0 && studentData.weight > 0) {
                    const bmi = calculateBMI(studentData.weight, studentData.height);
                    document.getElementById('profileBMI').textContent = bmi;
                } else {
                    document.getElementById('profileBMI').textContent = '0.00';
                }
                
                // Account Activity
                if (studentData.lastLogin) {
                    const lastLoginDate = new Date(studentData.lastLogin);
                    document.getElementById('lastLogin').textContent = lastLoginDate.toLocaleString();
                } else {
                    document.getElementById('lastLogin').textContent = 'Never';
                }
                
                if (studentData.createdAt) {
                    const createdDate = new Date(studentData.createdAt);
                    document.getElementById('accountCreated').textContent = createdDate.toLocaleDateString();
                } else {
                    document.getElementById('accountCreated').textContent = 'N/A';
                }
                
                // Emergency Contact
                document.getElementById('emergencyName').textContent = 
                    studentData.emergencyContactName || 'Not provided';
                document.getElementById('emergencyContact').textContent = 
                    studentData.emergencyContactNumber || 'Not provided';
                document.getElementById('emergencyRelation').textContent = 
                    studentData.emergencyContactRelation || 'Not provided';
                     updateProfileUI();
                // Update last login time
                await updateLastLogin(studentDocId);
            }
        } catch (error) {
            console.error('Error loading profile:', error);
            // Show minimal info even on error
            const nameInfo = extractNameFromEmail(user.email);
            document.getElementById('profileName').textContent = 
                `${nameInfo.firstName} ${nameInfo.lastName}`.trim();
            
            // Extract ID from email even on error
            const extractedId = extractUmakIdFromEmail(user.email);
            document.getElementById('profileId').textContent = `ID: ${extractedId}`;
            
            document.getElementById('profileEmail').textContent = user.email;
            document.getElementById('lastLogin').textContent = 'Now';
            document.getElementById('accountCreated').textContent = new Date().toLocaleDateString();

             updateProfileUI();
        }
    }

    async function updateLastLogin(studentId) {
        try {
            const studentRef = doc(db, 'students', studentId);
            await updateDoc(studentRef, {
                lastLogin: new Date().toISOString()
            });
            console.log('Last login updated');
        } catch (error) {
            console.error('Error updating last login:', error);
        }
    }

    onAuthStateChanged(auth, async (user) => {
        const loadingScreen = document.getElementById('loadingScreen');
        const mainContent = document.getElementById('mainContent');

        if (user) {
            try {
                await loadStudentProfile(user);
                loadingScreen.style.display = 'none';
                mainContent.style.display = 'block';
            } catch (error) {
                console.error('Error loading profile:', error);
                loadingScreen.style.display = 'none';
                mainContent.style.display = 'block';
            }
        } else {
            window.location.href = '../login/index.html';
        }
    });

    window.handleLogout = async function() {
        if (confirm('Are you sure you want to logout?')) {
            try {
                await signOut(auth);
                window.location.href = '../login/index.html';
            } catch (error) {
                console.error('Error logging out:', error);
            }
        }
    };

    window.editProfile = function() {
        const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
        
        // Populate form with current data
        const data = window.currentStudentData || {};
        document.getElementById('editAge').value = data.age || '';
        document.getElementById('editGender').value = data.gender || '';
        document.getElementById('editEmail').value = data.email || '';
        document.getElementById('editContact').value = data.contactNumber || '';
        document.getElementById('editHeight').value = data.height || '';
        document.getElementById('editWeight').value = data.weight || '';
        document.getElementById('editMedical').value = data.medicalCondition || '';
        document.getElementById('editEmergencyName').value = data.emergencyContactName || '';
        document.getElementById('editEmergencyContact').value = data.emergencyContactNumber || '';
        document.getElementById('editEmergencyRelation').value = data.emergencyContactRelation || '';
        
        modal.show();
    };

    window.saveProfile = async function() {
    const form = document.getElementById('editProfileForm');
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    try {
        // Extract UMak ID from email when saving
        const email = document.getElementById('editEmail').value;
        const extractedId = extractUmakIdFromEmail(email);
        const nameInfo = extractNameFromEmail(email);
        
        const height = parseFloat(document.getElementById('editHeight').value) || 0;
        const weight = parseFloat(document.getElementById('editWeight').value) || 0;
        
        // Get old height and weight to check if BMI changed
        const oldHeight = window.currentStudentData?.height || 0;
        const oldWeight = window.currentStudentData?.weight || 0;
        
        const updatedData = {
            firstName: nameInfo.firstName,
            lastName: nameInfo.lastName,
            age: parseInt(document.getElementById('editAge').value) || 0,
            gender: document.getElementById('editGender').value,
            email: email,
            contactNumber: document.getElementById('editContact').value,
            height: height,
            weight: weight,
            medicalCondition: document.getElementById('editMedical').value,
            emergencyContactName: document.getElementById('editEmergencyName').value,
            emergencyContactNumber: document.getElementById('editEmergencyContact').value,
            emergencyContactRelation: document.getElementById('editEmergencyRelation').value,
            umakId: extractedId,
            updatedAt: new Date().toISOString()
        };
        
        console.log('Updating student profile:', updatedData);
        
        // Import necessary Firestore functions if not already imported
        const { collection, addDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
        
        // Update student profile
        const studentRef = doc(db, 'students', window.currentStudentId);
        await updateDoc(studentRef, updatedData);
        
        // Check if height and weight changed and are valid
        const bmiChanged = (height !== oldHeight || weight !== oldWeight) && height > 0 && weight > 0;
        
        if (bmiChanged) {
            // Calculate BMI
            const bmi = calculateBMI(weight, height);
            const category = getBMICategory(bmi);
            
            // Store BMI record in BMI collection
            const bmiData = {
                studentId: window.currentStudentId,
                studentName: `${nameInfo.firstName} ${nameInfo.lastName}`.trim(),
                umakId: extractedId,
                section: window.currentStudentData?.section || 'Not Assigned',
                email: email,
                height: height,
                weight: weight,
                bmi: parseFloat(bmi),
                category: category,
                testType: 'pre', // Default to pre-test, can be updated by professor later
                recordedAt: new Date().toISOString(),
                recordedBy: 'student', // Indicates this was self-recorded
                updatedAt: new Date().toISOString()
            };
            
            console.log('Creating BMI record:', bmiData);
            
            // Add to BMI collection
            await addDoc(collection(db, 'BMI'), bmiData);
            
            console.log('BMI record created successfully');
            alert('Profile and BMI record updated successfully!');
        } else {
            alert('Profile updated successfully!');
        }
        
        bootstrap.Modal.getInstance(document.getElementById('editProfileModal')).hide();
        
        // Reload profile
        const user = auth.currentUser;
        await loadStudentProfile(user);
        updateProfileUI();
    } catch (error) {
        console.error('Error updating profile:', error);
        alert('Failed to update profile. Please try again.');
    }
};

    // Notification dropdown functions
    window.toggleNotificationDropdown = function() {
        const dropdown = document.getElementById('notificationDropdown');
        dropdown.classList.toggle('show');
    };

    window.closeNotificationDropdown = function() {
        const dropdown = document.getElementById('notificationDropdown');
        dropdown.classList.remove('show');
    };

    window.viewAllNotificationsFromDropdown = function() {
        alert('View all notifications feature would open here');
        closeNotificationDropdown();
    };

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('notificationDropdown');
        const bellBtn = document.getElementById('notificationBellBtn');
        if (dropdown.classList.contains('show') && 
            !dropdown.contains(event.target) && 
            !bellBtn.contains(event.target)) {
            dropdown.classList.remove('show');
        }
    });
        // Mobile menu toggle
window.toggleMobileMenu = function() {
    const menu = document.getElementById('mobileMenu');
    menu.classList.toggle('hidden');
};
            document.addEventListener('DOMContentLoaded', () => {
    const notificationBtn = document.getElementById('notificationBellBtn');
    if (notificationBtn) {
        notificationBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleNotificationDropdown(e);
            setTimeout(() => {
                document.addEventListener('click', closeProfileOnClickOutside);
            }, 100);
        });
    }
});
// Profile dropdown toggle
window.toggleProfileDropdown = function() {
    const isMobile = window.innerWidth < 1024;
    const dropdown = document.getElementById(isMobile ? 'profileDropdownMobile' : 'profileDropdown');
    const notificationDropdown = document.getElementById('notificationDropdown');
    
    // Close notification dropdown when opening profile
    if (notificationDropdown) {
        notificationDropdown.classList.add('hidden');
    }
    
    dropdown.classList.toggle('hidden');
    if (!dropdown.classList.contains('hidden')) {
        setTimeout(() => {
            document.addEventListener('click', closeProfileOnClickOutside);
        }, 100);
    } else {
        document.removeEventListener('click', closeProfileOnClickOutside);
    }
};

// Close dropdowns when clicking outside
function closeProfileOnClickOutside(event) {
    const isMobile = window.innerWidth < 1024;
    const dropdown = document.getElementById(isMobile ? 'profileDropdownMobile' : 'profileDropdown');
    const notificationDropdown = document.getElementById('notificationDropdown');
    const profileBtn = document.getElementById('profilePictureBtn');
    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
    const notificationBtn = document.getElementById('notificationBellBtn');
    
    // Close profile dropdown if clicked outside
    if (!dropdown.contains(event.target) && !profileBtn?.contains(event.target) && !profileBtnMobile?.contains(event.target)) {
        dropdown.classList.add('hidden');
    }
    
    // Close notification dropdown if clicked outside
    if (notificationDropdown && !notificationDropdown.contains(event.target) && !notificationBtn?.contains(event.target)) {
        notificationDropdown.classList.add('hidden');
    }
    
    // Remove listener if both are closed
    if (dropdown.classList.contains('hidden') && (!notificationDropdown || notificationDropdown.classList.contains('hidden'))) {
        document.removeEventListener('click', closeProfileOnClickOutside);
    }
}

    // Toggle notification dropdown
    window.toggleNotificationDropdown = function(event) {
        event?.stopPropagation();
        const dropdown = document.getElementById('notificationDropdown');
        
        if (dropdown.classList.contains('hidden')) {
            dropdown.classList.remove('hidden');
            loadNotificationDropdown();
            // Close profile dropdown if open
            const profileDropdown = document.getElementById('profileDropdown');
            const profileDropdownMobile = document.getElementById('profileDropdownMobile');
            if (profileDropdown) profileDropdown.classList.add('hidden');
            if (profileDropdownMobile) profileDropdownMobile.classList.add('hidden');
        } else {
            dropdown.classList.add('hidden');
        }
    };

    window.closeNotificationDropdown = function() {
        document.getElementById('notificationDropdown').classList.add('hidden');
    };
        // Load notification dropdown
async function loadNotificationDropdown() {
    try {
        if (!window.currentStudentData || !window.currentStudentData.section) return;

        const notificationsQuery = query(
            collection(db, 'notifications'),
            where('section', '==', window.currentStudentData.section)
        );
        
        const notificationsSnapshot = await getDocs(notificationsQuery);
        const dropdownBody = document.getElementById('notificationDropdownBody');
        
        if (!notificationsSnapshot.empty) {
            const notifications = [];
            notificationsSnapshot.forEach(doc => {
                notifications.push({ id: doc.id, ...doc.data() });
            });
            
            notifications.sort((a, b) => {
                const dateA = a.createdAt?.toDate?.() || new Date(0);
                const dateB = b.createdAt?.toDate?.() || new Date(0);
                return dateB - dateA;
            });
            
            let html = '';
            notifications.slice(0, 5).forEach(notification => {
                const createdDate = notification.createdAt?.toDate?.();
                const dateStr = createdDate ? createdDate.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'Recently';
                
                html += `
                    <div class="p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer">
                        <strong class="text-gray-900 text-sm block mb-1 font-semibold">${notification.title || 'Notification'}</strong>
                        <p class="text-gray-600 text-sm mb-1 leading-relaxed">${notification.message || ''}</p>
                        <small class="text-gray-400 text-xs">${dateStr}</small>
                    </div>
                `;
            });
            
            dropdownBody.innerHTML = html;
        } else {
            dropdownBody.innerHTML = `
                <div class="p-8 text-center text-gray-400">
                    <i class="bi bi-bell-slash text-5xl mb-3 block"></i>
                    <p class="text-gray-600">No notifications yet</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading notifications:', error);
    }
}
        function updateProfileUI() {
    if (!auth.currentUser || !window.currentStudentData) return;
    
    const photoURL = auth.currentUser?.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(window.currentStudentData?.firstName || 'User') + '&background=3b82f6&color=fff&size=128';
    
    const profileBtn = document.getElementById('profilePictureBtn');
    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
    if (profileBtn) profileBtn.src = photoURL;
    if (profileBtnMobile) profileBtnMobile.src = photoURL;
    
    const dropdownPic = document.getElementById('profileDropdownPicture');
    const dropdownPicMobile = document.getElementById('profileDropdownPictureMobile');
    if (dropdownPic) dropdownPic.src = photoURL;
    if (dropdownPicMobile) dropdownPicMobile.src = photoURL;
    
    const displayName = `${window.currentStudentData?.firstName || ''} ${window.currentStudentData?.lastName || ''}`.trim() || 'Student';
    
    const dropdownName = document.getElementById('profileDropdownName');
    const dropdownNameMobile = document.getElementById('profileDropdownNameMobile');
    if (dropdownName) dropdownName.textContent = displayName;
    if (dropdownNameMobile) dropdownNameMobile.textContent = displayName;
    
    const dropdownEmail = document.getElementById('profileDropdownEmail');
    const dropdownEmailMobile = document.getElementById('profileDropdownEmailMobile');
    if (dropdownEmail) dropdownEmail.textContent = window.currentStudentData?.email || auth.currentUser?.email || '';
    if (dropdownEmailMobile) dropdownEmailMobile.textContent = window.currentStudentData?.email || auth.currentUser?.email || '';
}
</script>
</body>
</html>