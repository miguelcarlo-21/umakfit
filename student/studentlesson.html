<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMak Fitness - Lessons</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .font-manrope { font-family: 'Manrope', sans-serif; }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinner {
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white/98 flex flex-col items-center justify-center z-50">
        <div class="spinner"></div>
        <div class="mt-5 text-gray-600 font-medium">Loading Lessons...</div>
    </div>

    <div id="mainContent" class="hidden">
        <!-- Navigation (Same as studentDashboard.html but with Lessons active) -->
        <nav class="bg-gradient-to-r from-blue-900 to-blue-500 shadow-lg">
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-5">
        <div class="flex flex-wrap items-center justify-between gap-3 sm:gap-4">
            <!-- Logo -->
            <a href="#" class="flex items-center gap-2 sm:gap-3">
                <img src="https://c.animaapp.com/vkhEa8zW/img/screenshot-2025-09-19-2-53-51-pm-removebg-preview-3@2x.png" 
                     alt="UMak Logo" class="h-12 sm:h-14 md:h-16 w-auto object-contain">
                <span class="text-xl sm:text-2xl md:text-3xl font-extrabold font-manrope bg-gradient-to-r from-yellow-400 to-yellow-200 bg-clip-text text-transparent">
                    UMakFit
                </span>
            </a>
            
            <!-- Desktop Navigation -->
            <div class="hidden lg:flex items-center gap-2 flex-wrap">
                <a href="./studentDashboard.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-speedometer2"></i> 
                    <span class="hidden xl:inline">Dashboard</span>
                </a>
                <a href="./test.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-clipboard-check"></i> 
                    <span class="hidden xl:inline">Tests</span>
                </a>
                <a href="#" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white text-gray-900 rounded-lg font-semibold text-sm flex items-center gap-2 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all">
                    <i class="bi bi-book"></i> 
                    <span class="hidden xl:inline">Lessons</span>
                </a>
                <a href="./studentgrades.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-award"></i> 
                    <span class="hidden xl:inline">Grades</span>
                </a>
                <a href="./progress.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-graph-up"></i> 
                    <span class="hidden xl:inline">Progress</span>
                </a>
                
                <!-- Notification Bell -->
                <div class="relative">
                    <button id="notificationBellBtn" 
                            class="w-9 h-9 xl:w-10 xl:h-10 bg-white/20 border-2 border-white/30 rounded-full flex items-center justify-center text-white hover:bg-white/30 hover:scale-110 transition-all">
                        <i class="bi bi-bell-fill text-base xl:text-lg"></i>
                        <span id="navNotificationCount" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full min-w-[18px] h-4.5 flex items-center justify-center">0</span>
                    </button>
                    
                    <!-- Notification Dropdown -->
                    <div id="notificationDropdown" class="hidden absolute right-0 mt-2 w-96 max-w-[calc(100vw-2rem)] bg-white rounded-xl shadow-2xl z-[9999] max-h-[480px] overflow-y-auto">
                        <div class="p-4 border-b-2 border-gray-200 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center rounded-t-xl sticky top-0 z-10">
                            <h6 class="font-bold text-gray-900 text-base flex items-center gap-2">
                                <i class="bi bi-bell-fill text-blue-500"></i> Notifications
                            </h6>
                            <button onclick="closeNotificationDropdown()" class="text-gray-400 hover:text-gray-600 p-1">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                        <div id="notificationDropdownBody" class="max-h-96 overflow-y-auto">
                            <div class="p-8 text-center text-gray-400">
                                <i class="bi bi-bell-slash text-5xl mb-3 block"></i>
                                <p class="text-gray-600">No notifications yet</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Dropdown -->
                <div class="relative">
                    <img src="" alt="Profile" id="profilePictureBtn"
                         class="w-9 h-9 xl:w-10 xl:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 hover:scale-105 transition-all object-cover">
                    
                    <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999]">
                        <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                            <img src="" alt="Profile" id="profileDropdownPicture" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                            <h6 id="profileDropdownName" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                            <p id="profileDropdownEmail" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
                        </div>
                        <div class="p-2">
                            <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                                <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                                <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                            </a>
                            <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                            <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                                <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                                <span class="font-medium text-sm sm:text-base">Logout</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Right Icons -->
            <div class="flex lg:hidden items-center gap-2 sm:gap-3">
                <!-- Mobile Notification Bell -->
                <button id="notificationBellBtnMobile" 
                        class="w-9 h-9 sm:w-10 sm:h-10 bg-white/20 border-2 border-white/30 rounded-full flex items-center justify-center text-white hover:bg-white/30 hover:scale-110 transition-all">
                    <i class="bi bi-bell-fill text-base"></i>
                    <span id="navNotificationCountMobile" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full min-w-[18px] h-4.5 flex items-center justify-center">0</span>
                </button>
                
                <!-- Mobile Profile -->
                <div class="relative">
                    <img src="" alt="Profile" id="profilePictureBtnMobile"
                         class="w-9 h-9 sm:w-10 sm:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 object-cover">
                </div>
                
                <!-- Mobile Menu Button -->
                <button id="mobileMenuBtn" class="text-white p-1 sm:p-2">
                    <i class="bi bi-list text-2xl sm:text-3xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Navigation Menu -->
        <div id="mobileMenu" class="hidden lg:hidden mt-3 sm:mt-4 space-y-2">
            <a href="./studentDashboard.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-speedometer2 mr-2"></i> Dashboard
            </a>
            <a href="./test.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-clipboard-check mr-2"></i> Tests
            </a>
            <a href="#" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white text-gray-900 rounded-lg font-semibold text-sm">
                <i class="bi bi-book mr-2"></i> Lessons
            </a>
            <a href="./studentgrades.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-award mr-2"></i> Grades
            </a>
            <a href="./progress.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-graph-up mr-2"></i> Progress
            </a>
        </div>
        
        <!-- Mobile Dropdowns (Fixed Position) -->
        <!-- Mobile Notification Dropdown -->
        <div id="notificationDropdownMobile" class="hidden fixed right-2 top-20 w-80 sm:w-96 bg-white rounded-xl shadow-2xl z-[9999] max-h-[480px] overflow-y-auto">
            <div class="p-4 border-b-2 border-gray-200 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center rounded-t-xl sticky top-0 z-10">
                <h6 class="font-bold text-gray-900 text-base flex items-center gap-2">
                    <i class="bi bi-bell-fill text-blue-500"></i> Notifications
                </h6>
                <button onclick="closeMobileNotificationDropdown()" class="text-gray-400 hover:text-gray-600 p-1">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div id="notificationDropdownBodyMobile" class="max-h-96 overflow-y-auto">
                <div class="p-8 text-center text-gray-400">
                    <i class="bi bi-bell-slash text-5xl mb-3 block"></i>
                    <p class="text-gray-600">No notifications yet</p>
                </div>
            </div>
        </div>
        
        <!-- Mobile Profile Dropdown -->
        <div id="profileDropdownMobile" class="hidden fixed right-2 top-20 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999]">
            <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                <img src="" alt="Profile" id="profileDropdownPictureMobile" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                <h6 id="profileDropdownNameMobile" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                <p id="profileDropdownEmailMobile" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
            </div>
            <div class="p-2">
                <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                    <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                    <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                </a>
                <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                    <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                    <span class="font-medium text-sm sm:text-base">Logout</span>
                </div>
            </div>
        </div>
    </div>
</nav>

        <!-- Main Content -->
        <div class="container mx-auto px-4 py-8 max-w-7xl">
            <!-- Page Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-2">Learning Materials</h1>
                <p class="text-gray-600">Access course materials, guides, and resources for your fitness journey</p>
            </div>

            <!-- No Lessons State -->
            <div id="noLessonsState" class="bg-white rounded-2xl shadow-lg p-16 text-center">
                <div class="max-w-md mx-auto">
                    <div class="mb-6">
                        <i class="bi bi-journal-text text-gray-300" style="font-size: 120px;"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-3">No Learning Materials Yet</h2>
                    <p class="text-gray-600 mb-6">Your professor hasn't uploaded any lessons or materials yet. Check back soon!</p>
                    <div class="inline-flex items-center gap-2 px-6 py-3 bg-blue-50 text-blue-700 rounded-lg">
                        <i class="bi bi-info-circle"></i>
                        <span class="font-medium">Materials will appear here when available</span>
                    </div>
                </div>
            </div>

            <!-- Lessons Container (Hidden initially, will show when lessons exist) -->
            <div id="lessonsContainer" class="hidden space-y-6">
                <!-- Lesson cards will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, query, where, getDocs, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAgaLunqEf2gs6dSpF_sz1hV5XQ5Wm52jo",
            authDomain: "umakfit-e3b1d.firebaseapp.com",
            projectId: "umakfit-e3b1d",
            storageBucket: "umakfit-e3b1d.appspot.com",
            messagingSenderId: "276569891504",
            appId: "1:276569891504:web:39b1732b519f4d8b785175"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let studentData = null;

        async function loadStudentData(user) {
            try {
                const studentsQuery = query(
                    collection(db, 'students'),
                    where('email', '==', user.email)
                );
                const studentsSnapshot = await getDocs(studentsQuery);
                
                if (!studentsSnapshot.empty) {
                    studentsSnapshot.forEach((doc) => {
                        studentData = doc.data();
                    });
                }
                return studentData;
            } catch (error) {
                console.error('Error loading student data:', error);
                return null;
            }
        }
                let currentUser = null;

// Update profile UI
                function updateProfileUI() {
                    if (!currentUser || !studentData) return;
                    
                    const photoURL = currentUser?.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(studentData?.displayName || studentData?.firstName + ' ' + studentData?.lastName || 'User') + '&background=3b82f6&color=fff&size=128';
                    
                    // Desktop
                    const profileBtn = document.getElementById('profilePictureBtn');
                    if (profileBtn) profileBtn.src = photoURL;
                    
                    const dropdownPic = document.getElementById('profileDropdownPicture');
                    if (dropdownPic) dropdownPic.src = photoURL;
                    
                    const dropdownName = document.getElementById('profileDropdownName');
                    if (dropdownName) dropdownName.textContent = studentData?.displayName || `${studentData?.firstName || ''} ${studentData?.lastName || ''}`.trim() || 'Student';
                    
                    const dropdownEmail = document.getElementById('profileDropdownEmail');
                    if (dropdownEmail) dropdownEmail.textContent = studentData?.email || currentUser?.email || '';
                    
                    // Mobile
                    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
                    if (profileBtnMobile) profileBtnMobile.src = photoURL;
                    
                    const dropdownPicMobile = document.getElementById('profileDropdownPictureMobile');
                    if (dropdownPicMobile) dropdownPicMobile.src = photoURL;
                    
                    const dropdownNameMobile = document.getElementById('profileDropdownNameMobile');
                    if (dropdownNameMobile) dropdownNameMobile.textContent = studentData?.displayName || `${studentData?.firstName || ''} ${studentData?.lastName || ''}`.trim() || 'Student';
                    
                    const dropdownEmailMobile = document.getElementById('profileDropdownEmailMobile');
                    if (dropdownEmailMobile) dropdownEmailMobile.textContent = studentData?.email || currentUser?.email || '';
                }

                // Toggle notification dropdown (Desktop)
                function toggleNotificationDropdown(event) {
                    event?.stopPropagation();
                    const dropdown = document.getElementById('notificationDropdown');
                    const profileDropdown = document.getElementById('profileDropdown');
                    
                    if (dropdown.classList.contains('hidden')) {
                        dropdown.classList.remove('hidden');
                        profileDropdown.classList.add('hidden');
                        loadNotificationDropdown();
                        setTimeout(() => {
                            document.addEventListener('click', closeOnClickOutside);
                        }, 100);
                    } else {
                        dropdown.classList.add('hidden');
                    }
                }

                // Toggle notification dropdown (Mobile)
                function toggleMobileNotificationDropdown(event) {
                    event?.stopPropagation();
                    const dropdown = document.getElementById('notificationDropdownMobile');
                    const profileDropdown = document.getElementById('profileDropdownMobile');
                    
                    if (dropdown.classList.contains('hidden')) {
                        dropdown.classList.remove('hidden');
                        profileDropdown.classList.add('hidden');
                        loadNotificationDropdown(true);
                        setTimeout(() => {
                            document.addEventListener('click', closeOnClickOutside);
                        }, 100);
                    } else {
                        dropdown.classList.add('hidden');
                    }
                }

                window.closeNotificationDropdown = function() {
                    document.getElementById('notificationDropdown').classList.add('hidden');
                }

                window.closeMobileNotificationDropdown = function() {
                    document.getElementById('notificationDropdownMobile').classList.add('hidden');
                }

                // Toggle profile dropdown (Desktop)
                function toggleProfileDropdown(event) {
                    event?.stopPropagation();
                    const dropdown = document.getElementById('profileDropdown');
                    const notificationDropdown = document.getElementById('notificationDropdown');
                    
                    if (dropdown.classList.contains('hidden')) {
                        dropdown.classList.remove('hidden');
                        notificationDropdown.classList.add('hidden');
                        setTimeout(() => {
                            document.addEventListener('click', closeOnClickOutside);
                        }, 100);
                    } else {
                        dropdown.classList.add('hidden');
                    }
                }

                // Toggle profile dropdown (Mobile)
                function toggleMobileProfileDropdown(event) {
                    event?.stopPropagation();
                    const dropdown = document.getElementById('profileDropdownMobile');
                    const notificationDropdown = document.getElementById('notificationDropdownMobile');
                    
                    if (dropdown.classList.contains('hidden')) {
                        dropdown.classList.remove('hidden');
                        notificationDropdown.classList.add('hidden');
                        setTimeout(() => {
                            document.addEventListener('click', closeOnClickOutside);
                        }, 100);
                    } else {
                        dropdown.classList.add('hidden');
                    }
                }

                // Close dropdowns when clicking outside
                function closeOnClickOutside(event) {
                    const profileDropdown = document.getElementById('profileDropdown');
                    const profileDropdownMobile = document.getElementById('profileDropdownMobile');
                    const notificationDropdown = document.getElementById('notificationDropdown');
                    const notificationDropdownMobile = document.getElementById('notificationDropdownMobile');
                    const profileBtn = document.getElementById('profilePictureBtn');
                    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
                    const notificationBtn = document.getElementById('notificationBellBtn');
                    const notificationBtnMobile = document.getElementById('notificationBellBtnMobile');
                    
                    if (!profileDropdown?.contains(event.target) && !profileBtn?.contains(event.target) &&
                        !profileDropdownMobile?.contains(event.target) && !profileBtnMobile?.contains(event.target)) {
                        profileDropdown?.classList.add('hidden');
                        profileDropdownMobile?.classList.add('hidden');
                    }
                    
                    if (!notificationDropdown?.contains(event.target) && !notificationBtn?.contains(event.target) &&
                        !notificationDropdownMobile?.contains(event.target) && !notificationBtnMobile?.contains(event.target)) {
                        notificationDropdown?.classList.add('hidden');
                        notificationDropdownMobile?.classList.add('hidden');
                    }
                    
                    if (profileDropdown?.classList.contains('hidden') && profileDropdownMobile?.classList.contains('hidden') &&
                        notificationDropdown?.classList.contains('hidden') && notificationDropdownMobile?.classList.contains('hidden')) {
                        document.removeEventListener('click', closeOnClickOutside);
                    }
                }

                // Load notification dropdown
                async function loadNotificationDropdown(isMobile = false) {
                    try {
                        if (!studentData || !studentData.section) return;

                        const notificationsQuery = query(
                            collection(db, 'notifications'),
                            where('section', '==', studentData.section)
                        );
                        
                        const notificationsSnapshot = await getDocs(notificationsQuery);
                        const dropdownBody = document.getElementById(isMobile ? 'notificationDropdownBodyMobile' : 'notificationDropdownBody');
                        
                        if (!notificationsSnapshot.empty) {
                            const notifications = [];
                            notificationsSnapshot.forEach(doc => {
                                notifications.push({ id: doc.id, ...doc.data() });
                            });
                            
                            notifications.sort((a, b) => {
                                const dateA = a.createdAt?.toDate?.() || new Date(0);
                                const dateB = b.createdAt?.toDate?.() || new Date(0);
                                return dateB - dateA;
                            });
                            
                            let html = '';
                            notifications.slice(0, 5).forEach(notification => {
                                const createdDate = notification.createdAt?.toDate?.();
                                const dateStr = createdDate ? createdDate.toLocaleDateString('en-US', {
                                    month: 'short',
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                }) : 'Recently';
                                
                                html += `
                                    <div class="p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors cursor-pointer">
                                        <strong class="text-gray-900 text-sm block mb-1 font-semibold">${notification.title || 'Notification'}</strong>
                                        <p class="text-gray-600 text-sm mb-1 leading-relaxed">${notification.message || ''}</p>
                                        <small class="text-gray-400 text-xs">${dateStr}</small>
                                    </div>
                                `;
                            });
                            
                            dropdownBody.innerHTML = html;
                        } else {
                            dropdownBody.innerHTML = `
                                <div class="p-8 text-center text-gray-400">
                                    <i class="bi bi-bell-slash text-5xl mb-3 block"></i>
                                    <p class="text-gray-600">No notifications yet</p>
                                </div>
                            `;
                        }
                    } catch (error) {
                        console.error('Error loading notifications:', error);
                    }
                }

                // Mobile menu toggle
                function toggleMobileMenu() {
                    const menu = document.getElementById('mobileMenu');
                    menu.classList.toggle('hidden');
                }

                // Logout handler
                window.handleLogout = async function() {
                    if (confirm('Are you sure you want to logout?')) {
                        try {
                            await signOut(auth);
                            window.location.href = '../login/index.html';
                        } catch (error) {
                            console.error('Error logging out:', error);
                            alert('Error logging out. Please try again.');
                        }
                    }
                }

                // Event listeners
                document.addEventListener('DOMContentLoaded', () => {
                    // Desktop
                    const notificationBtn = document.getElementById('notificationBellBtn');
                    if (notificationBtn) {
                        notificationBtn.addEventListener('click', toggleNotificationDropdown);
                    }
                    
                    const profileBtn = document.getElementById('profilePictureBtn');
                    if (profileBtn) {
                        profileBtn.addEventListener('click', toggleProfileDropdown);
                    }
                    
                    // Mobile
                    const notificationBtnMobile = document.getElementById('notificationBellBtnMobile');
                    if (notificationBtnMobile) {
                        notificationBtnMobile.addEventListener('click', toggleMobileNotificationDropdown);
                    }
                    
                    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
                    if (profileBtnMobile) {
                        profileBtnMobile.addEventListener('click', toggleMobileProfileDropdown);
                    }
                    
                    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                    if (mobileMenuBtn) {
                        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
                    }
                });
        async function loadLessons() {
            try {
                if (!studentData || !studentData.section) {
                    document.getElementById('loadingScreen').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    return;
                }

                // Query lessons for this section (adjust based on your Firebase structure)
                const lessonsQuery = query(
                    collection(db, 'lessons'),
                    where('section', '==', studentData.section)
                );
                
                const lessonsSnapshot = await getDocs(lessonsQuery);
                
                if (lessonsSnapshot.empty) {
                    document.getElementById('noLessonsState').classList.remove('hidden');
                } else {
                    document.getElementById('noLessonsState').classList.add('hidden');
                    document.getElementById('lessonsContainer').classList.remove('hidden');
                    
                    const container = document.getElementById('lessonsContainer');
                    let html = '';
                    
                    lessonsSnapshot.forEach((doc) => {
                        const lesson = doc.data();
                        html += renderLessonCard(lesson);
                    });
                    
                    container.innerHTML = html;
                }
                
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
            } catch (error) {
                console.error('Error loading lessons:', error);
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
            }
        }

        function renderLessonCard(lesson) {
            return `
                <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition-all p-6 border-l-4 border-blue-500">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <i class="bi bi-book-fill text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">${lesson.title || 'Untitled Lesson'}</h3>
                                    <p class="text-sm text-gray-500">Posted: ${lesson.createdAt?.toDate?.().toLocaleDateString() || 'N/A'}</p>
                                </div>
                            </div>
                            
                            ${lesson.description ? `
                            <p class="text-gray-700 mb-4 leading-relaxed">${lesson.description}</p>
                            ` : ''}
                            
                            ${lesson.materials && lesson.materials.length > 0 ? `
                            <div class="space-y-2">
                                <h4 class="font-semibold text-gray-700 text-sm uppercase tracking-wide">Materials:</h4>
                                ${lesson.materials.map(material => `
                                    <a href="${material.url}" target="_blank" download
                                       class="flex items-center gap-3 p-3 bg-gray-50 hover:bg-blue-50 rounded-lg transition-colors group">
                                        <i class="bi bi-file-earmark-arrow-down text-blue-600 text-xl"></i>
                                        <span class="font-medium text-gray-800 group-hover:text-blue-600">${material.name}</span>
                                        <i class="bi bi-download ml-auto text-gray-400 group-hover:text-blue-600"></i>
                                    </a>
                                `).join('')}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                await loadStudentData(user);
                updateProfileUI();
                await loadLessons();
            } else {
                window.location.href = '../login/index.html';
            }
        });
    </script>
</body>
</html>