<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMakiFit - Progress</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Manrope:wght@600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, rgba(245, 247, 250, 1) 0%, rgba(232, 238, 245, 1) 100%);
            min-height: 100vh;
        }

        /* Navigation */
.navbar-custom {
    background: linear-gradient(180deg, rgba(30, 58, 138, 1) 0%, rgba(59, 130, 246, 1) 100%);
    padding: 20px 0px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border-bottom: none;
    height: auto;
}

.navbar-brand {
    display: flex;
    align-items: center;
    gap: 15px;
    margin: 0;
    padding: 0;
}

.navbar-brand-img {
    height: 60px;
    width: auto;
    object-fit: contain;
}

.navbar-brand-text {
    font-family: "Manrope", Helvetica;
    font-weight: 800;
    font-size: 28px;
    background: linear-gradient(90deg, rgba(245, 158, 11, 1) 0%, rgba(255, 229, 0, 1) 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1;
}

.nav-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 20px;
}

.nav-pills-custom {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 0;
    margin: 0;
    list-style: none;
}

.nav-link-custom {
    font-family: "Manrope", Helvetica;
    font-weight: 600;
    color: #000000;
    font-size: 14px;
    padding: 12px 18px;
    border-radius: 8px;
    background-color: #ffffff;
    transition: all 0.3s;
    border: none;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    text-decoration: none;
}

.nav-link-custom:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    color: #000000;
}

.nav-link-custom i {
    font-size: 14px;
}

.nav-link-custom.active {
    background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
    box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
}

.notification-bell-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    width: 42px;
    height: 42px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 0;
}

.notification-bell-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    border-color: rgba(255, 255, 255, 0.5);
    transform: scale(1.1);
}

.notification-bell-btn i {
    font-size: 20px;
}

.btn-logout-nav {
    background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
    border: none;
    color: #000000;
    padding: 8px 20px;
    border-radius: 8px;
    font-family: "Manrope", Helvetica;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-logout-nav:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
}

.notification-bell-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: #ef4444;
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 0.15rem 0.4rem;
    border-radius: 10px;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.notification-bell-container {
    position: relative;
    display: inline-block;
}

.notification-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    width: 380px;
    max-height: 480px;
    overflow-y: auto;
    z-index: 1050;
    display: none;
    margin-top: 0.5rem;
    animation: slideDown 0.3s ease;
}

.notification-dropdown.show {
    display: block;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.notification-dropdown-header {
    padding: 1rem 1.25rem;
    border-bottom: 2px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #f8fafc, #ffffff);
    border-radius: 12px 12px 0 0;
}

.notification-dropdown-header h6 {
    margin: 0;
    font-size: 16px;
    font-weight: 700;
    color: #111827;
}

.notification-dropdown-body {
    max-height: 360px;
    overflow-y: auto;
}

.notification-dropdown-item {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid #f3f4f6;
    transition: background-color 0.2s ease;
    cursor: pointer;
}

.notification-dropdown-item:hover {
    background-color: #f9fafb;
}

.notification-dropdown-item:last-child {
    border-bottom: none;
}

.notification-dropdown-item strong {
    color: #111827;
    font-size: 14px;
    display: block;
    margin-bottom: 0.35rem;
    font-weight: 600;
}

.notification-dropdown-item p {
    color: #6b7280;
    font-size: 13px;
    margin: 0;
    line-height: 1.5;
}

.notification-dropdown-item small {
    color: #9ca3af;
    font-size: 11px;
    display: block;
    margin-top: 0.35rem;
}

.notification-dropdown-footer {
    padding: 0.75rem 1.25rem;
    border-top: 2px solid #e5e7eb;
    text-align: center;
    background-color: #f9fafb;
    border-radius: 0 0 12px 12px;
}

.btn-view-all-dropdown {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: white;
    border: none;
    padding: 0.5rem 1.25rem;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
}

.btn-view-all-dropdown:hover {
    background: linear-gradient(135deg, #2563eb, #1e40af);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
}

.notification-dropdown-empty {
    padding: 2rem 1.25rem;
    text-align: center;
    color: #9ca3af;
}

.notification-dropdown-empty i {
    font-size: 48px;
    color: #d1d5db;
    margin-bottom: 0.75rem;
    display: block;
}

.notification-dropdown-empty p {
    color: #6b7280;
    font-size: 14px;
    margin: 0;
}

.navbar-toggler {
    background-color: #ffffff;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
}

.navbar-toggler:focus {
    box-shadow: 0 0 0 0.25rem rgba(255,255,255,0.25);
}

.navbar-toggler-icon {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(0,0,0,1)' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E") !important;
}
        /* Main Content */
        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 3rem 5rem;
        }

        /* Professional Page Title with Vertical Accent and Underline */
.page-title {
    font-family: "Inter", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-weight: 700;
    color: #1f3b7c; /* Professional deep navy */
    font-size: 2.25rem; /* ~36px */
    line-height: 1.4;
    text-align: center;
    margin: 1.5rem 0 1.5rem 0;
    letter-spacing: 0.5px;
    text-transform: capitalize;
    position: relative;
    display: inline-block; /* keeps underline and bar aligned with text */
    padding-left: 1rem; /* space for the vertical line */
}

/* Vertical Accent Line */
.page-title::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 5px;
    background: linear-gradient(180deg, #1e3a8a, #3b82f6);
    border-radius: 2px;
}

        /* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    padding: 2rem;
    border-radius: 16px;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    min-height: 160px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.8);
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #3b82f6, #8b5cf6);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
}

.stat-card:hover::before {
    opacity: 1;
}

.stat-icon {
    width: 80px;
    height: 80px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}

.stat-icon::after {
    content: '';
    position: absolute;
    inset: -4px;
    border-radius: 18px;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.stat-card:hover .stat-icon::after {
    opacity: 1;
}

.stat-icon.blue {
    background: linear-gradient(135deg, #3b82f6, #1e40af);
}

.stat-icon.green {
    background: linear-gradient(135deg, #10b981, #059669);
}

.stat-icon.purple {
    background: linear-gradient(135deg, #8b5cf6, #6d28d9);
}

.stat-icon.pink {
    background: linear-gradient(135deg, #ec4899, #db2777);
}

.stat-info {
    flex: 1;
}

.stat-label {
    font-weight: 600;
    color: #64748b;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.75rem;
}

.stat-value {
    font-weight: 700;
    color: #1e293b;
    font-size: 2.5rem;
    line-height: 1.2;
    font-family: 'Manrope', sans-serif;
}

.stat-value.empty {
    color: #cbd5e1;
}

.stat-trend {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
    font-size: 13px;
    font-weight: 600;
}

.stat-trend.positive {
    color: #10b981;
}

.stat-trend.negative {
    color: #ef4444;
}

.stat-trend.neutral {
    color: #64748b;
}

       /* Charts Grid */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.chart-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    padding: 2.5rem;
    border-radius: 20px;
    min-height: 400px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.8);
    position: relative;
    overflow: hidden;
}

.chart-card canvas {
    max-height: 300px !important;
    height: 300px !important;
}

.chart-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.chart-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
}

.chart-card:hover::before {
    opacity: 1;
}

.chart-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f1f5f9;
}

.chart-icon {
    width: 32px;
    height: 32px;
    padding: 6px;
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.chart-title {
    font-weight: 700;
    color: #1e293b;
    font-size: 18px;
    font-family: 'Manrope', sans-serif;
    letter-spacing: -0.5px;
}

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            text-align: center;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            background: #f1f5f9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            font-size: 2.5rem;
        }

        .empty-title {
            font-weight: 600;
            color: #475569;
            font-size: 18px;
            margin-bottom: 0.5rem;
        }

        .empty-description {
            color: #94a3b8;
            font-size: 14px;
            max-width: 300px;
        }

        .take-test-btn {
            margin-top: 1.5rem;
            padding: 0.75rem 2rem;
            background: linear-gradient(90deg, rgba(251, 191, 36, 1) 0%, rgba(245, 158, 11, 1) 100%);
            border: none;
            border-radius: 8px;
            color: #000000;
            font-family: 'Manrope', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .take-test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.pulse-animation {
    animation: pulse 2s infinite;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.slide-down {
    animation: slideDown 0.3s ease;
}
/* Add to your CSS */
.improvement-tooltip {
    position: relative;
    cursor: help;
}

.improvement-tooltip:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 1000;
}
        /* Responsive */
        /* Responsive */
@media (max-width: 1200px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }

    .charts-grid {
        grid-template-columns: 1fr;
    }

    .chart-card.large {
        grid-column: span 1;
    }

    .container {
        padding: 2rem;
    }
}

@media (max-width: 991px) {
    .nav-link-custom {
        width: 100%;
        justify-content: flex-start;
    }
    
    .btn-logout-nav {
        width: 100%;
        justify-content: center;
    }
    
    .notification-bell-container {
        width: 100%;
        display: flex;
        justify-content: center;
    }
    
    .container {
        padding: 1.5rem;
    }
}

@media (max-width: 768px) {
    .page-title {
        font-size: 1.75rem;
    }
    
    .stat-value {
        font-size: 28px;
    }
}
@media (max-width: 1200px) {
    .chart-card {
        min-height: 380px;
    }
    
    .chart-card canvas {
        max-height: 280px !important;
        height: 280px !important;
    }
}

@media (max-width: 768px) {
    .chart-card {
        padding: 1.5rem;
        min-height: 350px;
    }
    
    .chart-card canvas {
        max-height: 250px !important;
        height: 250px !important;
    }
}
    </style>
</head>
<body>
    <!-- Navigation -->
<nav class="bg-gradient-to-r from-blue-900 to-blue-500 shadow-lg">
    <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-5">
        <div class="flex flex-wrap items-center justify-between gap-3 sm:gap-4">
            <!-- Logo -->
            <a href="#" class="flex items-center gap-2 sm:gap-3">
                <img src="https://c.animaapp.com/vkhEa8zW/img/screenshot-2025-09-19-2-53-51-pm-removebg-preview-3@2x.png" 
                     alt="UMak Logo" class="h-12 sm:h-14 md:h-16 w-auto object-contain">
                <span class="text-xl sm:text-2xl md:text-3xl font-extrabold font-manrope bg-gradient-to-r from-yellow-400 to-yellow-200 bg-clip-text text-transparent">
                    UMakFit
                </span>
            </a>
            
            <!-- Desktop Navigation -->
            <div class="hidden lg:flex items-center gap-2 flex-wrap">
                <a href="./studentdashboard.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-speedometer2"></i> 
                    <span class="hidden xl:inline">Dashboard</span>
                </a>
                <a href="./test.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-clipboard-check"></i> 
                    <span class="hidden xl:inline">Tests</span>
                </a>
                <a href="./studentlesson.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-book"></i> 
                    <span class="hidden xl:inline">Lesson</span>
                </a>
                <a href="./studentgrades.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-book"></i> 
                    <span class="hidden xl:inline">Grade</span>
                </a>
                <a href="./progress.html" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white text-gray-900 rounded-lg font-semibold text-sm flex items-center gap-2 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all">
                    <i class="bi bi-graph-up"></i> 
                    <span class="hidden xl:inline">Progress</span>
                </a>
                <a href="#" class="px-3 xl:px-4 py-2.5 xl:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-white/30 transition-all">
                    <i class="bi bi-book"></i> 
                    <span class="hidden xl:inline">Achievements</span>
                </a>
                
                <!-- Notification Bell -->
                <div class="relative">
                    <button onclick="toggleNotificationDropdown()" id="notificationBellBtn" 
                            class="w-9 h-9 xl:w-10 xl:h-10 bg-white/20 border-2 border-white/30 rounded-full flex items-center justify-center text-white hover:bg-white/30 hover:scale-110 transition-all">
                        <i class="bi bi-bell-fill text-base xl:text-lg"></i>
                        <span id="navNotificationCount" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full min-w-[18px] h-4.5 flex items-center justify-center pulse-animation">0</span>
                    </button>
                    
                    <!-- Notification Dropdown -->
                    <div id="notificationDropdown" class="hidden absolute right-0 mt-2 w-80 sm:w-96 max-w-[calc(100vw-2rem)] bg-white rounded-xl shadow-2xl z-[9999] slide-down max-h-[480px] overflow-y-auto">
                        <div class="p-3 sm:p-4 border-b-2 border-gray-200 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center rounded-t-xl sticky top-0 z-10">
                            <h6 class="font-bold text-gray-900 text-sm sm:text-base flex items-center gap-2">
                                <i class="bi bi-bell-fill text-blue-500"></i> Notifications
                            </h6>
                            <button onclick="closeNotificationDropdown()" class="text-gray-400 hover:text-gray-600 p-1">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                        <div id="notificationDropdownBody" class="max-h-96 overflow-y-auto">
                            <div class="p-6 sm:p-8 text-center text-gray-400">
                                <i class="bi bi-bell-slash text-4xl sm:text-5xl mb-3 block"></i>
                                <p class="text-gray-600 text-sm sm:text-base">No notifications yet</p>
                            </div>
                        </div>
                        <div class="p-2 sm:p-3 border-t-2 border-gray-200 bg-gray-50 rounded-b-xl sticky bottom-0">
                            <button onclick="viewAllNotificationsFromDropdown()" 
                                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-2 px-3 sm:px-4 rounded-lg font-semibold text-xs sm:text-sm hover:from-blue-600 hover:to-blue-700 hover:shadow-lg transition-all">
                                View All Notifications
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Dropdown -->
                <div class="relative">
                    <img src="" alt="Profile" id="profilePictureBtn" onclick="toggleProfileDropdown()"
                         class="w-9 h-9 xl:w-10 xl:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 hover:scale-105 transition-all object-cover">
                    
                    <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999] slide-down">
                        <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                            <img src="" alt="Profile" id="profileDropdownPicture" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                            <h6 id="profileDropdownName" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                            <p id="profileDropdownEmail" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
                        </div>
                        <div class="p-2">
                            <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                                <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                                <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                            </a>
                            <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                            <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                                <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                                <span class="font-medium text-sm sm:text-base">Logout</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Right Icons -->
            <div class="flex lg:hidden items-center gap-2 sm:gap-3">
                <!-- Mobile Notification -->
                <div class="relative">
                    <button onclick="toggleNotificationDropdown()" id="notificationBellBtnMobile" 
                            class="w-9 h-9 sm:w-10 sm:h-10 bg-white/20 border-2 border-white/30 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-all">
                        <i class="bi bi-bell-fill text-base"></i>
                        <span id="navNotificationCountMobile" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full min-w-[18px] h-4.5 flex items-center justify-center pulse-animation">0</span>
                    </button>
                    
                    <!-- Mobile Notification Dropdown (positioned fixed for mobile) -->
                    <div id="notificationDropdownMobile" class="hidden fixed right-2 left-2 top-20 bg-white rounded-xl shadow-2xl z-[9999] slide-down max-h-[calc(100vh-6rem)] overflow-y-auto">
                        <div class="p-3 sm:p-4 border-b-2 border-gray-200 bg-gradient-to-r from-gray-50 to-white flex justify-between items-center rounded-t-xl sticky top-0 z-10">
                            <h6 class="font-bold text-gray-900 text-sm sm:text-base flex items-center gap-2">
                                <i class="bi bi-bell-fill text-blue-500"></i> Notifications
                            </h6>
                            <button onclick="closeNotificationDropdown()" class="text-gray-400 hover:text-gray-600 p-1">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>
                        <div id="notificationDropdownBodyMobile" class="max-h-96 overflow-y-auto">
                            <div class="p-6 sm:p-8 text-center text-gray-400">
                                <i class="bi bi-bell-slash text-4xl sm:text-5xl mb-3 block"></i>
                                <p class="text-gray-600 text-sm sm:text-base">No notifications yet</p>
                            </div>
                        </div>
                        <div class="p-2 sm:p-3 border-t-2 border-gray-200 bg-gray-50 rounded-b-xl sticky bottom-0">
                            <button onclick="viewAllNotificationsFromDropdown()" 
                                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-2 px-3 sm:px-4 rounded-lg font-semibold text-xs sm:text-sm hover:from-blue-600 hover:to-blue-700 hover:shadow-lg transition-all">
                                View All Notifications
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Profile -->
                <div class="relative">
                    <img src="" alt="Profile" id="profilePictureBtnMobile" onclick="toggleProfileDropdown()"
                         class="w-9 h-9 sm:w-10 sm:h-10 rounded-full border-2 border-white/30 cursor-pointer hover:border-white/60 object-cover">
                    
                    <!-- Mobile Profile Dropdown (positioned fixed for mobile) -->
                    <div id="profileDropdownMobile" class="hidden fixed right-2 top-20 w-64 sm:w-72 bg-white rounded-xl shadow-2xl z-[9999] slide-down">
                        <div class="p-4 sm:p-6 border-b-2 border-gray-200 text-center">
                            <img src="" alt="Profile" id="profileDropdownPictureMobile" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full mx-auto mb-2 sm:mb-3 border-3 border-blue-500 object-cover">
                            <h6 id="profileDropdownNameMobile" class="font-bold text-gray-900 text-base sm:text-lg">Loading...</h6>
                            <p id="profileDropdownEmailMobile" class="text-xs sm:text-sm text-gray-500 mt-1 truncate px-2">Loading...</p>
                        </div>
                        <div class="p-2">
                            <a href="./studentProfile.html" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-gray-100 transition-colors">
                                <i class="bi bi-person-circle text-blue-500 text-lg sm:text-xl"></i>
                                <span class="font-medium text-gray-700 text-sm sm:text-base">View Profile</span>
                            </a>
                            <div class="h-px bg-gray-200 my-1 sm:my-2"></div>
                            <div onclick="handleLogout()" class="flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg hover:bg-red-50 transition-colors cursor-pointer text-red-500">
                                <i class="bi bi-box-arrow-right text-lg sm:text-xl"></i>
                                <span class="font-medium text-sm sm:text-base">Logout</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Menu Button -->
                <button onclick="toggleMobileMenu()" class="text-white p-1 sm:p-2">
                    <i class="bi bi-list text-2xl sm:text-3xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Navigation Menu -->
        <div id="mobileMenu" class="hidden lg:hidden mt-3 sm:mt-4 space-y-2">
            <a href="./studentdashboard.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-speedometer2 mr-2"></i> Dashboard
            </a>
            <a href="./test.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-clipboard-check mr-2"></i> Tests
            </a>
            <a href="./progress.html" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white text-gray-900 rounded-lg font-semibold text-sm">
                <i class="bi bi-graph-up mr-2"></i> Progress
            </a>
            <a href="#" class="block px-3 sm:px-4 py-2.5 sm:py-3 bg-white/20 text-white rounded-lg font-semibold text-sm">
                <i class="bi bi-book mr-2"></i> Learn
            </a>
        </div>
    </div>
</nav>

    <!-- Main Content -->
    <div class="container">
        <h1 class="page-title">Progress</h1>

              <!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon blue">
            <i class="bi bi-clipboard-check-fill" style="color: white; font-size: 32px;"></i>
        </div>
        <div class="stat-info">
            <div class="stat-label">Total Tests</div>
            <div class="stat-value" id="totalTests">0</div>
            <div class="stat-trend neutral" id="totalTestsTrend">
                <i class="bi bi-dash"></i>
                <span>No data yet</span>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon green">
            <i class="bi bi-graph-up-arrow" style="color: white; font-size: 32px;"></i>
        </div>
        <div class="stat-info">
            <div class="stat-label">Improvement</div>
            <div class="stat-value" id="overallImprovement">0%</div>
            <div class="stat-trend neutral" id="improvementTrend">
                <i class="bi bi-dash"></i>
                <span>Take more tests</span>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon purple">
            <i class="bi bi-trophy-fill" style="color: white; font-size: 32px;"></i>
        </div>
        <div class="stat-info">
            <div class="stat-label">Best Category</div>
            <div class="stat-value" style="font-size: 1.5rem;" id="bestCategory">--</div>
            <div class="stat-trend neutral" id="bestCategoryScore">
                <i class="bi bi-star-fill"></i>
                <span id="bestCategoryScoreText">No data</span>
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon pink">
            <i class="bi bi-calendar-check-fill" style="color: white; font-size: 32px;"></i>
        </div>
        <div class="stat-info">
            <div class="stat-label">Last Test</div>
            <div class="stat-value" style="font-size: 1.3rem;" id="lastTestDate">--</div>
            <div class="stat-trend neutral" id="lastTestName">
                <i class="bi bi-clock-history"></i>
                <span>No tests taken</span>
            </div>
        </div>
    </div>
</div>

        <!-- Charts -->
<div class="charts-grid">
    <!-- Cardiorespiratory Endurance -->
    <div class="chart-card">
        <div class="chart-header">
            <img class="chart-icon" src="https://c.animaapp.com/ZXSXG5cb/img/image-139@2x.png" alt="Chart">
            <h2 class="chart-title">Cardiorespiratory Endurance</h2>
        </div>
        <div id="cardioChart"></div>
    </div>

    <!-- Muscular Strength -->
    <div class="chart-card">
        <div class="chart-header">
            <img class="chart-icon" src="https://c.animaapp.com/ZXSXG5cb/img/image-139@2x.png" alt="Chart">
            <h2 class="chart-title">Muscular Strength</h2>
        </div>
        <div id="strengthChart"></div>
    </div>

    <!-- Muscular Endurance -->
    <div class="chart-card">
        <div class="chart-header">
            <img class="chart-icon" src="https://c.animaapp.com/ZXSXG5cb/img/image-139@2x.png" alt="Chart">
            <h2 class="chart-title">Muscular Endurance</h2>
        </div>
        <div id="enduranceChart"></div>
    </div>

    <!-- Flexibility -->
    <div class="chart-card">
        <div class="chart-header">
            <img class="chart-icon" src="https://c.animaapp.com/ZXSXG5cb/img/image-139@2x.png" alt="Chart">
            <h2 class="chart-title">Flexibility</h2>
        </div>
        <div id="flexibilityChart"></div>
    </div>

    <!-- Body Composition -->
    <div class="chart-card">
        <div class="chart-header">
            <img class="chart-icon" src="https://c.animaapp.com/ZXSXG5cb/img/image-139@2x.png" alt="Chart">
            <h2 class="chart-title">Body Composition</h2>
        </div>
        <div id="bodyCompChart"></div>
    </div>
</div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
    import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
        apiKey: "AIzaSyAgaLunqEf2gs6dSpF_sz1hV5XQ5Wm52jo",
        authDomain: "umakfit-e3b1d.firebaseapp.com",
        projectId: "umakfit-e3b1d",
        storageBucket: "umakfit-e3b1d.appspot.com",
        messagingSenderId: "276569891504",
        appId: "1:276569891504:web:39b1732b519f4d8b785175"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const testCategories = {
    'Cardiorespiratory Endurance': {
        tests: ['3-Minute Step Test', '1-Mile Run', '1 Mile Run'],
        icon: 'â¤ï¸',
        color: 'from-red-500 to-pink-500'
    },
    'Muscular Strength': {
        tests: ['Push-Up Test', 'Grip Strength', 'Push-up Test'],
        icon: 'ðŸ’ª',
        color: 'from-blue-500 to-indigo-500'
    },
    'Muscular Endurance': {
        tests: ['Curl-Up Test', 'Push-up Test', 'Plank Hold', 'Sit-Up Test'],
        icon: 'ðŸ”',
        color: 'from-orange-500 to-red-500'
    },
    'Flexibility': {
        tests: ['Sit-and-Reach', 'Shoulder Flexibility'],
        icon: 'ðŸ¤¸',
        color: 'from-green-500 to-emerald-500'
    },
    'Body Composition': {
        tests: ['BMI Assessment', 'Skinfold Caliper Measurements'],
        icon: 'âš–ï¸',
        color: 'from-purple-500 to-violet-500'
    }
};
    function getCategoryForTest(testName) {
    const normalized = testName.toLowerCase().trim();
    for (const [category, data] of Object.entries(testCategories)) {
        if (data.tests.some(t => normalized.includes(t.toLowerCase()) || t.toLowerCase().includes(normalized))) {
            return category;
        }
    }
    return 'Cardiorespiratory Endurance'; // Default fallback
}


    function calculateTestScore(testName, result, testTarget = null) {
    const normalized = testName.toLowerCase().trim();
    
    // Extract numeric value from result
    let numericValue = 0;
    
    if (typeof result === 'object' && result !== null) {
        numericValue = result.repetitions || result.time || result.distance || result.value || result.score || 0;
    } else if (typeof result === 'string') {
        const match = result.match(/(\d+\.?\d*)/);
        if (match) {
            numericValue = parseFloat(match[1]);
        } else {
            numericValue = parseFloat(result) || 0;
        }
    } else {
        numericValue = parseFloat(result) || 0;
    }
    
    // Use test target if available for more accurate scoring
    if (testTarget && testTarget > 0) {
        if (normalized.includes('push-up') || normalized.includes('pushup') || 
            normalized.includes('sit-up') || normalized.includes('situp') ||
            normalized.includes('curl-up')) {
            const reps = numericValue;
            const percentage = (reps / testTarget) * 100;
            let score = Math.min(100, Math.max(50, percentage));
            
            // Apply grading curve for better distribution
            if (percentage >= 100) score = 100;
            else if (percentage >= 90) score = 95;
            else if (percentage >= 80) score = 90;
            else if (percentage >= 70) score = 85;
            else if (percentage >= 60) score = 80;
            else if (percentage >= 50) score = 75;
            
            return Math.round(score);
            
        } else if (normalized.includes('plank')) {
            let seconds = 0;
            if (typeof result === 'string' && result.includes(':')) {
                const [mins, secs] = result.split(':').map(Number);
                seconds = (mins * 60) + (secs || 0);
            } else {
                seconds = numericValue;
            }
            
            const percentage = (seconds / testTarget) * 100;
            let score = Math.min(100, Math.max(50, percentage));
            
            if (percentage >= 100) score = 100;
            else if (percentage >= 90) score = 95;
            else if (percentage >= 80) score = 90;
            else if (percentage >= 70) score = 85;
            else if (percentage >= 60) score = 80;
            else if (percentage >= 50) score = 75;
            
            return Math.round(score);
            
        } else if (normalized.includes('sit-and-reach')) {
            const distance = numericValue;
            const percentage = (distance / testTarget) * 100;
            let score = Math.min(100, Math.max(50, percentage));
            
            if (percentage >= 100) score = 100;
            else if (percentage >= 90) score = 95;
            else if (percentage >= 80) score = 90;
            else if (percentage >= 70) score = 85;
            else if (percentage >= 60) score = 80;
            else if (percentage >= 50) score = 75;
            
            return Math.round(score);
        }
    }
    
    // Fallback to standard scoring if no target available
    if (normalized.includes('push-up') || normalized.includes('pushup')) {
        const reps = numericValue;
        if (reps >= 40) return 100;
        if (reps >= 35) return 95;
        if (reps >= 30) return 90;
        if (reps >= 25) return 85;
        if (reps >= 20) return 80;
        if (reps >= 15) return 75;
        if (reps >= 10) return 70;
        if (reps >= 5) return 65;
        return 60;
        
    } else if (normalized.includes('sit-up') || normalized.includes('situp')) {
        const reps = numericValue;
        if (reps >= 50) return 100;
        if (reps >= 45) return 95;
        if (reps >= 40) return 90;
        if (reps >= 35) return 85;
        if (reps >= 30) return 80;
        if (reps >= 25) return 75;
        if (reps >= 20) return 70;
        if (reps >= 15) return 65;
        return 60;
        
    } else if (normalized.includes('curl-up')) {
        const reps = numericValue;
        if (reps >= 75) return 100;
        if (reps >= 60) return 95;
        if (reps >= 50) return 90;
        if (reps >= 40) return 85;
        if (reps >= 30) return 80;
        if (reps >= 25) return 75;
        if (reps >= 20) return 70;
        return 65;
        
    } else if (normalized.includes('plank')) {
        let seconds = 0;
        if (typeof result === 'string' && result.includes(':')) {
            const [mins, secs] = result.split(':').map(Number);
            seconds = (mins * 60) + (secs || 0);
        } else {
            seconds = numericValue;
        }
        
        if (seconds >= 180) return 100;
        if (seconds >= 150) return 95;
        if (seconds >= 120) return 90;
        if (seconds >= 100) return 85;
        if (seconds >= 80) return 80;
        if (seconds >= 60) return 75;
        if (seconds >= 45) return 70;
        if (seconds >= 30) return 65;
        return 60;
        
    } else if (normalized.includes('step test') || normalized.includes('3-minute')) {
        const heartRate = numericValue;
        if (heartRate <= 70) return 100;
        if (heartRate <= 80) return 95;
        if (heartRate <= 90) return 90;
        if (heartRate <= 100) return 85;
        if (heartRate <= 110) return 80;
        if (heartRate <= 120) return 75;
        if (heartRate <= 130) return 70;
        return 65;
        
    } else if (normalized.includes('mile') || normalized.includes('run')) {
        let totalSeconds = 0;
        if (typeof result === 'string' && result.includes(':')) {
            const [minutes, seconds] = result.split(':').map(Number);
            totalSeconds = (minutes * 60) + (seconds || 0);
        } else {
            totalSeconds = numericValue;
        }
        
        if (totalSeconds <= 360) return 100;
        if (totalSeconds <= 420) return 95;
        if (totalSeconds <= 480) return 90;
        if (totalSeconds <= 540) return 85;
        if (totalSeconds <= 600) return 80;
        if (totalSeconds <= 660) return 75;
        if (totalSeconds <= 720) return 70;
        if (totalSeconds <= 780) return 65;
        return 60;
        
    } else if (normalized.includes('sit-and-reach')) {
        const distance = numericValue;
        if (distance >= 25) return 100;
        if (distance >= 20) return 95;
        if (distance >= 15) return 90;
        if (distance >= 10) return 85;
        if (distance >= 5) return 80;
        if (distance >= 0) return 75;
        if (distance >= -5) return 70;
        return 65;
        
    } else if (normalized.includes('grip')) {
        const strength = numericValue;
        if (strength >= 60) return 100;
        if (strength >= 55) return 95;
        if (strength >= 50) return 90;
        if (strength >= 45) return 85;
        if (strength >= 40) return 80;
        if (strength >= 35) return 75;
        if (strength >= 30) return 70;
        return 65;
    } else if (normalized.includes('bmi')) {
        const bmi = numericValue;
        // Healthy BMI range is 18.5-24.9
        if (bmi >= 18.5 && bmi <= 24.9) return 100;
        if (bmi >= 17.5 && bmi < 18.5) return 85;
        if (bmi >= 25 && bmi <= 27) return 85;
        if (bmi >= 15 && bmi < 17.5) return 70;
        if (bmi > 27 && bmi <= 30) return 70;
        return 60;
    }
    
    return 75;
}

    function renderEmptyState(containerId, category) {
        const container = document.getElementById(containerId);
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">ðŸ“Š</div>
                <div class="empty-title">No Data Available</div>
                <div class="empty-description">Take your first ${category} test to see your progress</div>
                <button class="take-test-btn" onclick="window.location.href='./test.html'">Take Test</button>
            </div>
        `;
    }

    function createProgressChart(containerId, data, category) {
    const container = document.getElementById(containerId);
    
    if (!container) {
        console.error(`Container ${containerId} not found`);
        return;
    }
    
    if (!data || data.length === 0) {
        renderEmptyState(containerId, category);
        return;
    }

    try {
        // Store chart instance for cleanup
        if (container.chartInstance) {
            container.chartInstance.destroy();
        }
        
        // Clear container and create canvas
        container.innerHTML = '<canvas id="' + containerId + 'Canvas"></canvas>';
        const canvas = document.getElementById(containerId + 'Canvas');
        
        if (!canvas) {
            throw new Error('Canvas element not created');
        }
        
        const ctx = canvas.getContext('2d');

        // Prepare chart data
        const labels = data.map(item => item.date);
        const scores = data.map(item => item.score);
        
        // Color schemes matching the reference images
        const colorSchemes = {
            'Cardiorespiratory Endurance': {
                bg: 'rgba(167, 139, 250, 0.3)',
                border: 'rgb(139, 92, 246)',
                point: 'rgb(124, 58, 237)'
            },
            'Muscular Strength': {
                bg: 'rgba(251, 113, 133, 0.3)',
                border: 'rgb(244, 63, 94)',
                point: 'rgb(225, 29, 72)'
            },
            'Muscular Endurance': {
                bg: 'rgba(251, 191, 36, 0.3)',
                border: 'rgb(245, 158, 11)',
                point: 'rgb(217, 119, 6)'
            },
            'Flexibility': {
                bg: 'rgba(134, 239, 172, 0.3)',
                border: 'rgb(34, 197, 94)',
                point: 'rgb(22, 163, 74)'
            },
            'Body Composition': {
                bg: 'rgba(147, 197, 253, 0.3)',
                border: 'rgb(59, 130, 246)',
                point: 'rgb(37, 99, 235)'
            }
        };

        const colorScheme = colorSchemes[category] || colorSchemes['Cardiorespiratory Endurance'];

        // Create gradient
        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, colorScheme.bg);
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0.05)');

        // Calculate highest score for annotation
        const maxScore = Math.max(...scores);
        const maxIndex = scores.indexOf(maxScore);

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Score',
                    data: scores,
                    backgroundColor: gradient,
                    borderColor: colorScheme.border,
                    borderWidth: 3,
                    pointBackgroundColor: colorScheme.point,
                    pointBorderColor: '#fff',
                    pointBorderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.95)',
                        titleColor: '#1f2937',
                        bodyColor: '#6b7280',
                        borderColor: colorScheme.border,
                        borderWidth: 2,
                        padding: 12,
                        displayColors: false,
                        titleFont: {
                            size: 14,
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 13
                        },
                        callbacks: {
                            title: function(context) {
                                return data[context[0].dataIndex].testName;
                            },
                            label: function(context) {
                                return 'Score: ' + context.parsed.y + '/100';
                            },
                            afterLabel: function(context) {
                                return 'Result: ' + data[context.dataIndex].result;
                            }
                        }
                    },
                    annotation: {
                        annotations: {
                            label1: {
                                type: 'label',
                                xValue: maxIndex,
                                yValue: maxScore,
                                backgroundColor: 'rgba(255, 255, 255, 0.95)',
                                borderColor: colorScheme.border,
                                borderWidth: 2,
                                borderRadius: 8,
                                padding: 8,
                                content: [maxScore.toString()],
                                color: colorScheme.point,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 140,
                        ticks: {
                            stepSize: 20,
                            callback: function(value) {
                                return value;
                            },
                            font: {
                                size: 11,
                                weight: '500'
                            },
                            color: '#9ca3af'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 11,
                                weight: '500'
                            },
                            color: '#9ca3af',
                            maxRotation: 0,
                            minRotation: 0
                        },
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                }
            }
        });

        // Store chart instance for cleanup
        container.chartInstance = chart;

    } catch (error) {
        console.error(`Error creating chart for ${containerId}:`, error);
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">âš ï¸</div>
                <div class="empty-title">Chart Error</div>
                <div class="empty-description">Failed to load chart data</div>
            </div>
        `;
    }
}
                    // Handle window resize to prevent chart issues
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    // Destroy and recreate charts on resize
                    if (currentUser && studentData) {
                        loadProgressData(currentUser.email);
                    }
                }, 250);
            });
// Helper function to calculate trend line
function calculateTrendLine(data) {
    if (data.length < 2) return data;
    
    const n = data.length;
    let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
    
    for (let i = 0; i < n; i++) {
        sumX += i;
        sumY += data[i];
        sumXY += i * data[i];
        sumXX += i * i;
    }
    
    const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
    const intercept = (sumY - slope * sumX) / n;
    
    return Array.from({length: n}, (_, i) => slope * i + intercept);
}
        let currentUser = null;
let studentData = null;

// Mobile menu toggle
window.toggleMobileMenu = function() {
    const menu = document.getElementById('mobileMenu');
    if (menu) {
        menu.classList.toggle('hidden');
    }
};

// Notification dropdown
window.toggleNotificationDropdown = function() {
    const isMobile = window.innerWidth < 1024;
    const dropdown = document.getElementById(isMobile ? 'notificationDropdownMobile' : 'notificationDropdown');
    const dropdownBody = document.getElementById(isMobile ? 'notificationDropdownBodyMobile' : 'notificationDropdownBody');
    
    dropdown.classList.toggle('hidden');
    if (!dropdown.classList.contains('hidden')) {
        loadNotificationDropdown(dropdownBody);
        setTimeout(() => {
            document.addEventListener('click', closeOnClickOutside);
        }, 100);
    } else {
        document.removeEventListener('click', closeOnClickOutside);
    }
};

window.closeNotificationDropdown = function() {
    const dropdownDesktop = document.getElementById('notificationDropdown');
    const dropdownMobile = document.getElementById('notificationDropdownMobile');
    if (dropdownDesktop) dropdownDesktop.classList.add('hidden');
    if (dropdownMobile) dropdownMobile.classList.add('hidden');
    document.removeEventListener('click', closeOnClickOutside);
};

function closeOnClickOutside(event) {
    const isMobile = window.innerWidth < 1024;
    const dropdown = document.getElementById(isMobile ? 'notificationDropdownMobile' : 'notificationDropdown');
    const bellBtn = document.getElementById('notificationBellBtn');
    const bellBtnMobile = document.getElementById('notificationBellBtnMobile');
    if (!dropdown.contains(event.target) && !bellBtn?.contains(event.target) && !bellBtnMobile?.contains(event.target)) {
        closeNotificationDropdown();
    }
}

// Profile dropdown
window.toggleProfileDropdown = function() {
    const isMobile = window.innerWidth < 1024;
    const dropdown = document.getElementById(isMobile ? 'profileDropdownMobile' : 'profileDropdown');
    
    dropdown.classList.toggle('hidden');
    if (!dropdown.classList.contains('hidden')) {
        closeNotificationDropdown();
        setTimeout(() => {
            document.addEventListener('click', closeProfileOnClickOutside);
        }, 100);
    } else {
        document.removeEventListener('click', closeProfileOnClickOutside);
    }
};

window.closeProfileDropdown = function() {
    const dropdownDesktop = document.getElementById('profileDropdown');
    const dropdownMobile = document.getElementById('profileDropdownMobile');
    if (dropdownDesktop) dropdownDesktop.classList.add('hidden');
    if (dropdownMobile) dropdownMobile.classList.add('hidden');
    document.removeEventListener('click', closeProfileOnClickOutside);
};

function closeProfileOnClickOutside(event) {
    const isMobile = window.innerWidth < 1024;
    const dropdown = document.getElementById(isMobile ? 'profileDropdownMobile' : 'profileDropdown');
    const profileBtn = document.getElementById('profilePictureBtn');
    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
    if (!dropdown.contains(event.target) && !profileBtn?.contains(event.target) && !profileBtnMobile?.contains(event.target)) {
        closeProfileDropdown();
    }
}

async function loadNotificationDropdown(customBody = null) {
    // Placeholder - you can implement notification loading here
    console.log('Loading notifications...');
}

window.viewAllNotificationsFromDropdown = function() {
    closeNotificationDropdown();
    alert('View all notifications feature');
};

function updateProfileUI() {
    if (!currentUser) return;
    
    const photoURL = currentUser?.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(studentData?.displayName || 'User') + '&background=3b82f6&color=fff&size=128';
    
    // Update all profile pictures
    const profileBtn = document.getElementById('profilePictureBtn');
    const profileBtnMobile = document.getElementById('profilePictureBtnMobile');
    if (profileBtn) profileBtn.src = photoURL;
    if (profileBtnMobile) profileBtnMobile.src = photoURL;
    
    // Update dropdown pictures
    const dropdownPic = document.getElementById('profileDropdownPicture');
    const dropdownPicMobile = document.getElementById('profileDropdownPictureMobile');
    if (dropdownPic) dropdownPic.src = photoURL;
    if (dropdownPicMobile) dropdownPicMobile.src = photoURL;
    
    // Update names
    const dropdownName = document.getElementById('profileDropdownName');
    const dropdownNameMobile = document.getElementById('profileDropdownNameMobile');
    if (dropdownName) dropdownName.textContent = studentData?.displayName || currentUser.email.split('@')[0];
    if (dropdownNameMobile) dropdownNameMobile.textContent = studentData?.displayName || currentUser.email.split('@')[0];
    
    // Update emails
    const dropdownEmail = document.getElementById('profileDropdownEmail');
    const dropdownEmailMobile = document.getElementById('profileDropdownEmailMobile');
    if (dropdownEmail) dropdownEmail.textContent = currentUser.email;
    if (dropdownEmailMobile) dropdownEmailMobile.textContent = currentUser.email;
    
}document.querySelectorAll('.stat-value').forEach(el => {
    if (el.textContent === '0' || el.textContent === '--') {
        el.innerHTML = '<div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"></div>';
    }
});
    async function loadProgressData(userEmail) {
    try {
        console.log('Loading progress data for:', userEmail);
        
        const resultsQuery = query(
            collection(db, 'testResults'),
            where('studentEmail', '==', userEmail)
        );
        
        const resultsSnapshot = await getDocs(resultsQuery);
        
        console.log('Total test results found:', resultsSnapshot.size);
        
        if (resultsSnapshot.empty) {
            console.log('No test results found');
            // Show empty state for all stats
            document.getElementById('totalTests').textContent = '0';
            document.getElementById('overallImprovement').textContent = '0%';
            document.getElementById('bestCategory').textContent = '--';
            document.getElementById('lastTestDate').textContent = '--';
            
            // Render empty states for all charts using CORRECT categories
            renderEmptyState('cardioChart', 'Cardiorespiratory Endurance');
            renderEmptyState('strengthChart', 'Muscular Strength');
            renderEmptyState('enduranceChart', 'Muscular Endurance');
            renderEmptyState('flexibilityChart', 'Flexibility');
            renderEmptyState('bodyCompChart', 'Body Composition');
            return;
        }
        
        const categoryData = {
            'Cardiorespiratory Endurance': [],
            'Muscular Strength': [],
            'Muscular Endurance': [],
            'Flexibility': [],
            'Body Composition': []
        };
        
        const categoryScores = {
            'Cardiorespiratory Endurance': [],
            'Muscular Strength': [],
            'Muscular Endurance': [],
            'Flexibility': [],
            'Body Composition': []
        };
        
        let allTestResults = [];
        
        resultsSnapshot.forEach((doc) => {
            const result = doc.data();
            console.log('Processing result:', result.testName, result.result);
            
            const category = getCategoryForTest(result.testName);
            
            if (category) {
                const score = calculateTestScore(result.testName, result.result, result.testTarget);
                
                // Parse the date properly
                let testDate;
                let timestamp;
                
                if (result.submittedAt) {
                    if (result.submittedAt.toDate) {
                        testDate = result.submittedAt.toDate();
                    } else if (result.submittedAt.seconds) {
                        testDate = new Date(result.submittedAt.seconds * 1000);
                    } else {
                        testDate = new Date(result.submittedAt);
                    }
                } else {
                    testDate = new Date();
                }
                
                timestamp = testDate.getTime();
                const formattedDate = testDate.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
                
                const testData = {
                    testName: result.testName,
                    score: score,
                    result: result.result,
                    date: formattedDate,
                    timestamp: timestamp
                };
                
                // Add to category data
                categoryData[category].push(testData);
                categoryScores[category].push(score);
                
                // Add to all test results
                allTestResults.push(testData);
                
                console.log(`Added ${result.testName} to ${category}: score=${score}, date=${formattedDate}`);
            } else {
                console.warn('No category found for test:', result.testName);
            }
        });
        
        // Sort all data by timestamp (chronological order)
        Object.keys(categoryData).forEach(category => {
            categoryData[category].sort((a, b) => a.timestamp - b.timestamp);
            console.log(`${category} has ${categoryData[category].length} tests`);
        });
        
        allTestResults.sort((a, b) => a.timestamp - b.timestamp);
        
        // Calculate statistics
        const totalTests = resultsSnapshot.size;
        let overallImprovement = 0;
        
        // Calculate improvement
        if (allTestResults.length >= 2) {
            const firstTest = allTestResults[0];
            const lastTest = allTestResults[allTestResults.length - 1];
            
            if (firstTest.score > 0) {
                overallImprovement = Math.round(((lastTest.score - firstTest.score) / firstTest.score) * 100);
            }
            
            // Apply bounds
            overallImprovement = Math.max(-50, Math.min(100, overallImprovement));
            
            // If improvement is very small, treat as stable
            if (Math.abs(overallImprovement) < 3) {
                overallImprovement = 0;
            }
        }
        
        // Find best category
        let bestCategory = '--';
        let bestScore = 0;
        Object.entries(categoryScores).forEach(([category, scores]) => {
            if (scores.length > 0) {
                const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
                if (avgScore > bestScore) {
                    bestScore = avgScore;
                    bestCategory = category;
                }
            }
        });
        
        // Get last test info
        let lastTestDate = '--';
        let lastTestNameText = 'No tests taken';
        
        if (allTestResults.length > 0) {
            const lastTest = allTestResults[allTestResults.length - 1];
            lastTestDate = lastTest.date;
            lastTestNameText = lastTest.testName;
        }
        
        // UPDATE STAT CARDS
        document.getElementById('totalTests').textContent = totalTests;
        document.getElementById('totalTestsTrend').innerHTML = totalTests > 0 
            ? `<i class="bi bi-check-circle-fill"></i><span>${totalTests} completed</span>`
            : `<i class="bi bi-dash"></i><span>No data yet</span>`;
        
        document.getElementById('overallImprovement').textContent = 
            overallImprovement > 0 ? `+${overallImprovement}%` : `${overallImprovement}%`;
        
        // Update improvement trend
        const improvementTrend = document.getElementById('improvementTrend');
        if (overallImprovement > 5) {
            improvementTrend.className = 'stat-trend positive';
            improvementTrend.innerHTML = `<i class="bi bi-arrow-up-circle-fill"></i><span>Great progress!</span>`;
        } else if (overallImprovement < -5) {
            improvementTrend.className = 'stat-trend negative';
            improvementTrend.innerHTML = `<i class="bi bi-arrow-down-circle-fill"></i><span>Keep practicing</span>`;
        } else {
            improvementTrend.className = 'stat-trend neutral';
            improvementTrend.innerHTML = totalTests > 1 
                ? `<i class="bi bi-dash-circle"></i><span>Stable performance</span>`
                : `<i class="bi bi-dash"></i><span>Take more tests</span>`;
        }
        
        document.getElementById('bestCategory').textContent = bestCategory;
        document.getElementById('bestCategoryScore').className = bestScore > 0 ? 'stat-trend positive' : 'stat-trend neutral';
        document.getElementById('bestCategoryScoreText').textContent = bestScore > 0 
            ? `${Math.round(bestScore)} avg score`
            : 'No data';
        
        document.getElementById('lastTestDate').textContent = lastTestDate;
        document.getElementById('lastTestName').innerHTML = `<i class="bi bi-clock-history"></i><span>${lastTestNameText}</span>`;
        
        // Create progress charts with CORRECT category names
        createProgressChart('cardioChart', categoryData['Cardiorespiratory Endurance'], 'Cardiorespiratory Endurance');
        createProgressChart('strengthChart', categoryData['Muscular Strength'], 'Muscular Strength');
        createProgressChart('enduranceChart', categoryData['Muscular Endurance'], 'Muscular Endurance');
        createProgressChart('flexibilityChart', categoryData['Flexibility'], 'Flexibility');
        createProgressChart('bodyCompChart', categoryData['Body Composition'], 'Body Composition');
        
        console.log('Progress data loaded successfully');
        
    } catch (error) {
        console.error('Error loading progress data:', error);
        
        // Show error state
        document.getElementById('totalTests').textContent = 'Error';
        document.getElementById('overallImprovement').textContent = 'Error';
        document.getElementById('bestCategory').textContent = 'Error';
        document.getElementById('lastTestDate').textContent = 'Error';
        
        ['cardioChart', 'strengthChart', 'enduranceChart', 'flexibilityChart', 'bodyCompChart'].forEach(id => {
            const container = document.getElementById(id);
            if (container) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">âš ï¸</div>
                        <div class="empty-title">Error Loading Data</div>
                        <div class="empty-description">Please refresh the page to try again</div>
                    </div>
                `;
            }
        });
    }
}


onAuthStateChanged(auth, async (user) => {
    if (user) {
        try {
            console.log('User authenticated:', user.email);
            currentUser = user;
            
            // Load student data from Firestore
            const studentsQuery = query(
                collection(db, 'students'),
                where('email', '==', user.email)
            );
            
            const studentsSnapshot = await getDocs(studentsQuery);
            
            if (!studentsSnapshot.empty) {
                const studentDoc = studentsSnapshot.docs[0];
                const data = studentDoc.data();
                studentData = {
                    displayName: `${data.firstName || ''} ${data.lastName || ''}`.trim() || user.email.split('@')[0],
                    email: user.email,
                    firstName: data.firstName || '',
                    lastName: data.lastName || ''
                };
                console.log('Student data loaded:', studentData);
            } else {
                // Fallback if student document doesn't exist
                studentData = {
                    displayName: user.displayName || user.email.split('@')[0],
                    email: user.email
                };
                console.log('Using fallback student data:', studentData);
            }
            
            // Update profile UI
            updateProfileUI();
            
            // Load progress data
            console.log('Loading progress for:', user.email);
            await loadProgressData(user.email);
            
            console.log('Page fully loaded');
            
        } catch (error) {
            console.error('Error loading page:', error);
            console.error('Error stack:', error.stack);
            alert('Error loading your progress data. Please refresh the page.');
        }
    } else {
        console.log('No user authenticated, redirecting to login');
        window.location.href = '../login/index.html';
    }
});
</script>
</body>
</html>